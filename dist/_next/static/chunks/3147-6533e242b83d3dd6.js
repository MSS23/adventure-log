"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3147],{1243:(e,t,o)=>{o.d(t,{Bb:()=>c,CK:()=>p,F4:()=>g,gN:()=>u});var a=o(96648),i=o(82466);let l=[{id:"photos",name:"photos",public:!0,fileSizeLimit:0x3200000,allowedMimeTypes:["image/jpeg","image/png","image/webp","image/gif"]},{id:"avatars",name:"avatars",public:!0,fileSizeLimit:5242880,allowedMimeTypes:["image/jpeg","image/png","image/webp"]}];class r extends Error{constructor(e,t,o,a){super(e),this.code=t,this.bucket=o,this.filePath=a,this.name="StorageError"}}class s{async simpleUpload(e,t,o){console.log("\uD83D\uDE80 SIMPLE UPLOAD: Starting basic upload (bypassing validation):",{bucketId:e,filePath:t,fileName:o.name,fileSize:o.size,fileType:o.type});try{let{data:a,error:i}=await this.supabase.storage.from(e).upload(t,o);if(console.log("\uD83D\uDE80 SIMPLE UPLOAD: Response:",{data:a,error:i}),i)throw console.error("❌ SIMPLE UPLOAD: Failed:",i),new r("Simple upload failed: ".concat(i.message),"SIMPLE_UPLOAD_FAILED",e,t);let{data:l}=this.supabase.storage.from(e).getPublicUrl(t);return console.log("✅ SIMPLE UPLOAD: Success!",{publicUrl:l.publicUrl}),l.publicUrl}catch(e){throw console.error("❌ SIMPLE UPLOAD: Exception:",e),e}}async checkBucketExists(e){return console.log("\uD83D\uDD0D Skipping bucket check for:",e,"(assumes bucket exists)"),!0}async validateFile(e,t){console.log("\uD83D\uDD0D File validation details:",{fileName:e.name,fileSize:e.size,fileType:e.type,bucketId:t});let o=l.find(e=>e.id===t);if(!o)throw console.error("❌ Unknown bucket:",t),new r("Unknown bucket: ".concat(t),"UNKNOWN_BUCKET",t);if(console.log("✅ Bucket config found:",o),console.log("\uD83D\uDCCF Size check:",{fileSize:e.size,fileSizeMB:(e.size/1024/1024).toFixed(2)+"MB",limit:o.fileSizeLimit,limitMB:Math.round(o.fileSizeLimit/1024/1024)+"MB"}),e.size>o.fileSizeLimit){let a=Math.round(o.fileSizeLimit/1024/1024);throw console.error("❌ File too large:",{fileSize:e.size,maxSize:o.fileSizeLimit,maxSizeMB:a}),new r("File too large. Maximum size is ".concat(a,"MB"),"FILE_TOO_LARGE",t)}if(console.log("✅ File size check passed"),console.log("\uD83C\uDFAD MIME type check:",{fileType:e.type,allowedTypes:o.allowedMimeTypes,isAllowed:o.allowedMimeTypes.includes(e.type)}),!o.allowedMimeTypes.includes(e.type))throw console.error("❌ Invalid file type:",{fileType:e.type,allowedTypes:o.allowedMimeTypes}),new r("File type not allowed. Supported types: ".concat(o.allowedMimeTypes.join(", ")),"INVALID_FILE_TYPE",t);console.log("✅ MIME type check passed")}async uploadWithRetry(e,t,o){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{maxRetries:l=3,retryDelay:s=1e3}=a;console.log("\uD83D\uDE80 Starting upload process:",{bucketId:e,filePath:t,fileName:o.name,fileSize:o.size,fileType:o.type,lastModified:o.lastModified}),console.log("\uD83D\uDD0D Starting file validation..."),await this.validateFile(o,e),console.log("✅ File validation passed"),console.log("\uD83E\uDEA3 Checking bucket existence...");let n=await this.checkBucketExists(e);console.log("\uD83E\uDEA3 Bucket check result:",{bucketId:e,exists:n}),n?console.log("✅ Bucket exists, proceeding with upload"):console.warn("⚠️ Bucket check failed, but proceeding anyway (bucket might exist):",e);let c=null;for(let a=1;a<=l;a++)try{i.Rm.info("Attempting file upload",{component:"StorageHelper",action:"uploadWithRetry",bucketId:e,filePath:t,fileName:o.name,fileSize:o.size,attempt:a,maxRetries:l}),console.log("\uD83D\uDCE4 Attempt ".concat(a,": Starting Supabase upload..."));let{data:s,error:n}=await this.supabase.storage.from(e).upload(t,o);if(console.log("\uD83D\uDCE4 Attempt ".concat(a,": Upload response:"),{uploadData:s,uploadError:n?{message:n.message,name:n.name,cause:n.cause}:null}),n)throw console.error("❌ Upload failed on attempt ".concat(a,":"),n),new r(n.message,"UPLOAD_FAILED",e,t);console.log("✅ Upload successful on attempt ".concat(a));let{data:c}=this.supabase.storage.from(e).getPublicUrl(t);return i.Rm.info("File upload successful",{component:"StorageHelper",action:"uploadWithRetry",bucketId:e,filePath:t,publicUrl:c.publicUrl,attempt:a}),c.publicUrl}catch(o){if(c=o instanceof Error?o:Error(String(o)),i.Rm.warn("Upload attempt failed",{component:"StorageHelper",action:"uploadWithRetry",bucketId:e,filePath:t,attempt:a,maxRetries:l,error:c.message}),o instanceof r&&["FILE_TOO_LARGE","INVALID_FILE_TYPE","BUCKET_NOT_FOUND"].includes(o.code))throw o;a<l&&await new Promise(e=>setTimeout(e,s*a))}console.log("⚠️ Complex upload failed, trying simple upload fallback...");try{let a=await this.simpleUpload(e,t,o);return console.log("✅ FALLBACK SUCCESS: Simple upload worked!"),a}catch(o){throw console.error("❌ FALLBACK FAILED: Both complex and simple upload failed"),new r("Upload failed after ".concat(l," attempts and fallback: ").concat((null==c?void 0:c.message)||"Unknown error",". Fallback error: ").concat(o instanceof Error?o.message:String(o)),"ALL_UPLOAD_METHODS_FAILED",e,t)}}async deleteFile(e,t){try{let{error:o}=await this.supabase.storage.from(e).remove([t]);if(o)throw new r(o.message,"DELETE_FAILED",e,t);i.Rm.info("File deleted successfully",{component:"StorageHelper",action:"deleteFile",bucketId:e,filePath:t})}catch(o){if(i.Rm.error("File deletion failed",{component:"StorageHelper",action:"deleteFile",bucketId:e,filePath:t},o instanceof Error?o:Error(String(o))),o instanceof r)throw o;throw new r("Failed to delete file: ".concat(o instanceof Error?o.message:String(o)),"DELETE_FAILED",e,t)}}generateUniqueFilePath(e,t){let o=e.split(".").pop(),a=Date.now(),i=Math.random().toString(36).substring(7);return"".concat(t?"".concat(t,"-"):"").concat(a,"-").concat(i,".").concat(o)}constructor(){this.supabase=(0,a.U)()}}let n=new s,c=e=>{if(e instanceof r)switch(e.code){case"FILE_TOO_LARGE":return"Image is too large. Please compress or choose a smaller image (max 50MB).";case"INVALID_FILE_TYPE":return"File type not supported. Please use JPEG, PNG, WebP, or GIF images.";case"BUCKET_NOT_FOUND":return"Storage system error. Please try again or contact support.";case"SIMPLE_UPLOAD_FAILED":return"Upload failed: ".concat(e.message);case"ALL_UPLOAD_METHODS_FAILED":return"Upload failed after multiple attempts. Please check your connection and try again.";default:return e.message||"Upload failed. Please try again."}return e instanceof Error?e.message.includes("413")||e.message.includes("too large")?"Image is too large. Please compress or choose a smaller image.":e.message.includes("network")||e.message.includes("fetch")?"Network error. Please check your connection and try again.":e.message.includes("bucket")||e.message.includes("storage")?"Storage system error. Please try again.":e.message.includes("timeout")?"Upload timed out. Please try again.":e.message:"Unknown error occurred. Please try again."},d=["id","album_id","user_id","file_path","file_size","width","height","caption","taken_at","latitude","longitude","country","city","city_id","island_id","exif_data","processing_status","order_index","created_at"],p=e=>{let t={};for(let[o,a]of Object.entries(e))d.includes(o)?t[o]=a:console.warn("⚠️ Skipping unknown column '".concat(o,"' for photos table"));return t},u=async(e,t)=>{console.log("\uD83D\uDCF8 uploadPhoto called:",{fileName:e.name,fileSize:e.size,fileType:e.type,userId:t});let o=n.generateUniqueFilePath(e.name,t);console.log("\uD83D\uDCF8 Generated file path:",o);try{let t=await n.uploadWithRetry("photos",o,e);return console.log("\uD83D\uDCF8 uploadPhoto success:",t),t}catch(e){throw console.error("\uD83D\uDCF8 uploadPhoto failed:",e),e}},g=async(e,t)=>{let o="avatars/".concat(n.generateUniqueFilePath(e.name,t));return n.uploadWithRetry("avatars",o,e)}},31120:(e,t,o)=>{o.d(t,{T:()=>l});var a=o(95155);o(12115);var i=o(64269);function l(e){let{className:t,...o}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,i.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...o})}},62890:(e,t,o)=>{o.d(t,{UU:()=>r});var a=o(87559);o(95704);let i="https://jjrqstbzzvqrgaqwdvxw.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpqcnFzdGJ6enZxcmdhcXdkdnh3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0ODc4MDcsImV4cCI6MjA3NDA2MzgwN30.aSHFHAA5Tv2EUDu7nxwOWXSFFUxbOUCR65Vi52QkjX4";if(!i||!l)throw Error("Missing Supabase environment variables");function r(){return(0,a.createBrowserClient)(i,l)}},65142:(e,t,o)=>{o.d(t,{p:()=>l});var a=o(95155);o(12115);var i=o(64269);function l(e){let{className:t,type:o,...l}=e;return(0,a.jsx)("input",{type:o,"data-slot":"input",className:(0,i.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...l})}},76444:(e,t,o)=>{o.d(t,{J:()=>r});var a=o(95155);o(12115);var i=o(10489),l=o(64269);function r(e){let{className:t,...o}=e;return(0,a.jsx)(i.b,{"data-slot":"label",className:(0,l.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...o})}}}]);