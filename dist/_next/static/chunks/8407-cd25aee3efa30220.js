"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8407],{43691:(e,t,r)=>{r.d(t,{A:()=>l,O:()=>c});var i=r(95155),n=r(12115),o=r(96648),a=r(82466);let s=(0,n.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,n.useState)(null),[l,u]=(0,n.useState)(null),[d,f]=(0,n.useState)(!0),[h,m]=(0,n.useState)(!1),g=(0,n.useRef)(new Map),v=(0,o.U)(),p=(0,n.useCallback)(async e=>{try{let t=e.replace(/-/g,"").substring(0,8),r="user_".concat(t),i={id:e,username:r,display_name:"New User",privacy_level:"public"},{data:n,error:o}=await v.from("profiles").insert(i).select().single();if(o){if(a.Rm.error("Profile creation error details",{component:"AuthProvider",action:"createProfile",userId:e,username:r,errorCode:o.code,errorMessage:o.message,errorDetails:o.details,errorHint:o.hint}),"23505"===o.code&&o.message.includes("username")){let r=Date.now().toString().slice(-4),n="user_".concat(t,"_").concat(r),{data:o,error:s}=await v.from("profiles").insert({...i,username:n}).select().single();if(s)return a.Rm.error("Error creating profile with fallback username",{component:"AuthProvider",action:"createProfile",userId:e,fallbackUsername:n,error:s}),null;return a.Rm.info("Profile created with fallback username",{component:"AuthProvider",action:"createProfile",userId:e,username:n}),o}if("23505"===o.code&&(o.message.includes("id")||o.message.includes("pkey"))){a.Rm.warn("Profile already exists, attempting to fetch existing profile",{component:"AuthProvider",action:"createProfile",userId:e});try{let{data:t,error:r}=await v.from("profiles").select("*").eq("id",e).single();if(!r&&t)return a.Rm.info("Successfully fetched existing profile after creation conflict",{component:"AuthProvider",action:"createProfile",userId:e}),t}catch(t){a.Rm.error("Failed to fetch existing profile after creation conflict",{component:"AuthProvider",action:"createProfile",userId:e,error:t})}}return a.Rm.error("Error creating profile",{component:"AuthProvider",action:"createProfile",userId:e,username:r,error:o}),null}return a.Rm.info("Profile created successfully",{component:"AuthProvider",action:"createProfile",userId:e,username:r}),n}catch(t){return a.Rm.error("Error creating profile",{component:"AuthProvider",action:"createProfile",userId:e},t instanceof Error?t:Error(String(t))),null}},[v]),w=(0,n.useCallback)(async function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(t){let t=g.current.get(e);if(t&&Date.now()-t.timestamp<t.ttl)return t.data}try{let{data:t,error:r}=await v.from("profiles").select("*").eq("id",e).single();if(r){if(a.Rm.error("Profile fetch error details",{component:"AuthProvider",action:"fetchProfile",userId:e,errorCode:r.code,errorMessage:r.message,errorDetails:r.details,errorHint:r.hint}),"PGRST116"===r.code||r.message.includes("No rows returned")){a.Rm.warn("Profile not found, attempting to create",{component:"AuthProvider",action:"fetchProfile",userId:e});let t=await p(e);if(t)return g.current.set(e,{data:t,timestamp:Date.now(),ttl:3e5}),t}else if(r.message.includes("406")||r.message.includes("Not Acceptable")){a.Rm.error("RLS policy blocking profile access",{component:"AuthProvider",action:"fetchProfile",userId:e,error:r.message});let t=await p(e);if(t)return g.current.set(e,{data:t,timestamp:Date.now(),ttl:3e5}),t}return a.Rm.error("Error fetching profile",{component:"AuthProvider",action:"fetchProfile",userId:e,error:r}),null}return g.current.set(e,{data:t,timestamp:Date.now(),ttl:3e5}),t}catch(t){return a.Rm.error("Error fetching profile",{component:"AuthProvider",action:"fetchProfile",userId:e},t instanceof Error?t:Error(String(t))),null}},[v,p]),b=(0,n.useCallback)(async e=>{m(!0);try{let t=await w(e);u(t)}finally{m(!1)}},[w]),P=async()=>{if(r){m(!0);try{let e=await w(r.id,!1);u(e)}finally{m(!1)}}};(0,n.useEffect)(()=>{(async()=>{try{var e;let{data:{session:t}}=await v.auth.getSession();c(null!=(e=null==t?void 0:t.user)?e:null),f(!1),(null==t?void 0:t.user)&&b(t.user.id)}catch(e){a.Rm.error("Error getting session",{error:e}),f(!1)}})();let{data:{subscription:e}}=v.auth.onAuthStateChange(async(e,t)=>{var r;c(null!=(r=null==t?void 0:t.user)?r:null),f(!1),(null==t?void 0:t.user)?b(t.user.id):(u(null),m(!1),g.current.clear())});return()=>e.unsubscribe()},[b,v.auth]);let y=async()=>{try{await v.auth.signOut(),c(null),u(null),m(!1),g.current.clear()}catch(e){a.Rm.error("Error signing out",{error:e})}};return(0,i.jsx)(s.Provider,{value:{user:r,profile:l,authLoading:d,profileLoading:h,signOut:y,refreshProfile:P},children:t})}function l(){let e=(0,n.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},44781:(e,t,r)=>{r.d(t,{D:()=>s,ThemeProvider:()=>c});var i=r(95155),n=r(12115),o=r(58941);let a=(0,n.createContext)(void 0);function s(){let e=(0,n.useContext)(a);if(!e)throw Error("useTheme must be used within a ThemeProvider");return e}function c(e){let{children:t,defaultTheme:s="system"}=e,[c,l]=(0,n.useState)(s),[u,d]=(0,n.useState)("light"),[f,h]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=e=>{d(e?"dark":"light")};if(o.OD.isWeb()){let t=window.matchMedia("(prefers-color-scheme: dark)"),r=t=>{e(t.matches)};return e(t.matches),t.addEventListener("change",r),()=>t.removeEventListener("change",r)}e(!1)},[]),(0,n.useEffect)(()=>{let e=null;o.OD.isWeb()?e=localStorage.getItem("adventure-log-theme"):r.e(4077).then(r.bind(r,4077)).then(e=>{let{Preferences:t}=e;t.get({key:"adventure-log-theme"}).then(e=>{let{value:t}=e;t&&["light","dark","system"].includes(t)&&l(t)}).catch(()=>{})}).catch(()=>{}),o.OD.isWeb()&&e&&["light","dark","system"].includes(e)&&l(e),h(!0)},[]),(0,n.useEffect)(()=>{if(!f)return;let e="system"===c?u:c;if("undefined"!=typeof document){let t=document.documentElement;t.classList.remove("light","dark"),t.classList.add(e),t.setAttribute("data-theme",e)}o.OD.isWeb()?localStorage.setItem("adventure-log-theme",c):r.e(4077).then(r.bind(r,4077)).then(e=>{let{Preferences:t}=e;t.set({key:"adventure-log-theme",value:c}).catch(()=>{})}).catch(()=>{})},[c,u,f]);let m="system"===c?u:c,g={theme:c,systemTheme:u,currentTheme:m,setTheme:l,toggleTheme:()=>{l("light"===m?"dark":"light")}};return f?(0,i.jsx)(a.Provider,{value:g,children:t}):(0,i.jsx)(a.Provider,{value:g,children:(0,i.jsx)("div",{style:{visibility:"hidden"},children:t})})}},58941:(e,t,r)=>{r.d(t,{OD:()=>n});var i=r(32587);class n{static getInfo(){if(!this.info){let e=i.Ii.getPlatform();this.info={isWeb:"web"===e,isNative:"web"!==e,isAndroid:"android"===e,isIOS:"ios"===e,platform:e}}return this.info}static isWeb(){return this.getInfo().isWeb}static isNative(){return this.getInfo().isNative}static isAndroid(){return this.getInfo().isAndroid}static isIOS(){return this.getInfo().isIOS}static getPlatform(){return this.getInfo().platform}static isCapabilityAvailable(e){let{isNative:t,isWeb:r}=this.getInfo();switch(e){case"camera":return t||r&&"MediaDevices"in window&&"getUserMedia"in navigator.mediaDevices;case"geolocation":return t||r&&"geolocation"in navigator;case"filesystem":return t||r&&"File"in window;case"share":return t||r&&"share"in navigator;case"toast":return!0;default:return!1}}static getUserAgent(){return"undefined"!=typeof navigator?navigator.userAgent:""}static isDevelopment(){return!1}static isStandalone(){let{isNative:e}=this.getInfo();return!!e||window.matchMedia("(display-mode: standalone)").matches||"standalone"in navigator&&!0===navigator.standalone}static getDeviceInfo(){var e;let t=this.getInfo(),r=this.getUserAgent();return{...t,userAgent:r,isStandalone:this.isStandalone(),isDevelopment:this.isDevelopment(),hasTouch:"ontouchstart"in window,screen:{width:window.screen.width,height:window.screen.height,orientation:null==(e=window.screen.orientation)?void 0:e.type}}}}n.info=null},82466:(e,t,r)=>{r.d(t,{Rm:()=>a});var i=function(e){return e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e}({});class n{shouldLog(e){return e>=this.minLevel}formatTimestamp(){return new Date().toISOString()}createLogEntry(e,t,r,i){return{level:e,message:t,timestamp:this.formatTimestamp(),context:r,error:i}}formatConsoleMessage(e){let t=i[e.level],r=e.context?" [".concat(Object.entries(e.context).map(e=>{let[t,r]=e;return"".concat(t,":").concat(r)}).join(", "),"]"):"";return"[".concat(e.timestamp,"] ").concat(t).concat(r,": ").concat(e.message)}logToConsole(e){if(!this.shouldLog(e.level))return;let t=this.formatConsoleMessage(e);switch(e.level){case 0:console.debug(t,e.error||"");break;case 1:console.info(t,e.error||"");break;case 2:console.warn(t,e.error||"");break;case 3:console.error(t,e.error||"")}}logToExternalService(e){this.isDevelopment||e.level}log(e,t,r,i){let n=this.createLogEntry(e,t,r,i);this.logToConsole(n),this.logToExternalService(n)}debug(e,t){this.log(0,e,t)}info(e,t){this.log(1,e,t)}warn(e,t,r){this.log(2,e,t,r)}error(e,t,r){this.log(3,e,t,r)}userAction(e,t,r){this.info("User action: ".concat(e),{component:"user-action",action:e,userId:t,...r})}apiCall(e,t,r){this.debug("API call: ".concat(t," ").concat(e),{component:"api",endpoint:e,method:t,...r})}performance(e,t,r){this.info("Performance: ".concat(e," took ").concat(t,"ms"),{component:"performance",operation:e,duration:t,...r})}constructor(){this.isDevelopment=!1,this.minLevel=+!this.isDevelopment}}let o=new n,a={debug:(e,t)=>o.debug(e,t),info:(e,t)=>o.info(e,t),warn:(e,t,r)=>o.warn(e,t,r),error:(e,t,r)=>o.error(e,t,r),userAction:(e,t,r)=>o.userAction(e,t,r),apiCall:(e,t,r)=>o.apiCall(e,t,r),performance:(e,t,r)=>o.performance(e,t,r)}},96648:(e,t,r)=>{r.d(t,{U:()=>a});var i=r(87559);let n="https://jjrqstbzzvqrgaqwdvxw.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpqcnFzdGJ6enZxcmdhcXdkdnh3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0ODc4MDcsImV4cCI6MjA3NDA2MzgwN30.aSHFHAA5Tv2EUDu7nxwOWXSFFUxbOUCR65Vi52QkjX4";if(!n||!o)throw Error("Missing Supabase environment variables");function a(){return(0,i.createBrowserClient)(n,o)}}}]);