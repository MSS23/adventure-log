(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3353],{16032:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>V});var i=a(95155),s=a(12115),l=a(20063),r=a(22544),o=a(66942),n=a(41508),c=a(43691),d=a(62890),m=a(86948),u=a(3998),g=a(65142),p=a(76444),h=a(31120),x=a(80991),f=a(6132),b=a(35626),y=a(21873),j=a(16485),v=a(95664),N=a(23061),w=a(65229),S=a(21786),z=a(61362),C=a(52619),F=a.n(C),L=a(15239),O=a(11636),P=a(50246),A=a(99029),I=a(82466),D=a(1243),R=a(57172);class T{setStages(e){this.stages=e,this.currentStageIndex=0}start(e){var t;this.startTime=Date.now(),this.currentStageIndex=0,this.logContext&&I.Rm.debug("Loading started: ".concat(e||"Unknown operation"),this.logContext),this.updateState({isLoading:!0,loadingText:e||"Loading...",progress:this.stages.length>0?0:void 0,stage:null==(t=this.stages[0])?void 0:t.key})}nextStage(e){if(this.currentStageIndex<this.stages.length-1){this.currentStageIndex++;let t=this.stages[this.currentStageIndex];this.updateState({isLoading:!0,loadingText:e||t.text,progress:this.calculateProgress(),stage:t.key})}}updateProgress(e,t){var a;this.updateState({isLoading:!0,loadingText:e||this.getCurrentStageText(),progress:null!=t?t:this.calculateProgress(),stage:null==(a=this.getCurrentStage())?void 0:a.key})}complete(e){let t=Date.now()-this.startTime;this.logContext&&I.Rm.performance("Loading completed",t,this.logContext),e?(this.updateState({isLoading:!1,loadingText:e,progress:100,stage:"complete"}),setTimeout(()=>{this.updateState({isLoading:!1,loadingText:"",progress:void 0,stage:void 0})},2e3)):this.updateState({isLoading:!1,loadingText:"",progress:void 0,stage:void 0})}error(e){let t=Date.now()-this.startTime;this.logContext&&I.Rm.warn("Loading failed after ".concat(t,"ms"),this.logContext),this.updateState({isLoading:!1,loadingText:e,progress:void 0,stage:"error"})}calculateProgress(){if(0===this.stages.length)return 0;let e=this.stages.reduce((e,t)=>e+t.weight,0),t=0;for(let e=0;e<this.currentStageIndex;e++)t+=this.stages[e].weight;return Math.round(t/e*100)}getCurrentStage(){return this.stages[this.currentStageIndex]}getCurrentStageText(){var e;return(null==(e=this.getCurrentStage())?void 0:e.text)||"Loading..."}updateState(e){this.onUpdate(e)}constructor(e,t){this.stages=[],this.currentStageIndex=0,this.startTime=0,this.onUpdate=e,this.logContext=null==t?void 0:t.logContext}}function k(e){let[t,a]=(0,s.useState)({isLoading:!1,loadingText:(null==e?void 0:e.initialText)||""}),i=(0,s.useRef)(null);i.current||(i.current=new T(a,e));let l=(0,s.useCallback)((e,t)=>{t&&i.current.setStages(t),i.current.start(e)},[]),r=(0,s.useCallback)(e=>{i.current.nextStage(e)},[]),o=(0,s.useCallback)((e,t)=>{i.current.updateProgress(e,t)},[]),n=(0,s.useCallback)(e=>{i.current.complete(e)},[]),c=(0,s.useCallback)(e=>{i.current.error(e)},[]);return{...t,startLoading:l,nextStage:r,updateProgress:o,completeLoading:n,errorLoading:c}}let _={ALBUM_CREATION:[{key:"validating",text:"Validating data...",weight:10},{key:"creating",text:"Creating album...",weight:30},{key:"uploading",text:"Uploading photos...",weight:50},{key:"finalizing",text:"Finalizing album...",weight:10}]};var E=a(64269),M=a(35299),U=a(11647);function B(e){let{size:t="md",className:a}=e;return(0,i.jsx)(M.A,{className:(0,E.cn)("animate-spin",{sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8"}[t],a)})}function W(e){let{progress:t,className:a,showPercentage:s=!1}=e;return(0,i.jsxs)("div",{className:(0,E.cn)("space-y-2",a),children:[(0,i.jsx)(x.k,{value:t,className:"h-2"}),s&&void 0!==t&&(0,i.jsxs)("div",{className:"text-sm text-gray-800 text-center",children:[Math.round(t),"%"]})]})}function q(e){let{loadingState:t,className:a}=e,{isLoading:s,loadingText:l,progress:r,stage:o}=t;return s?(0,i.jsxs)("div",{className:(0,E.cn)("flex items-center space-x-3 p-4 bg-blue-50 rounded-lg border border-blue-200",a),children:[(0,i.jsx)(B,{size:"sm",className:"text-blue-600"}),(0,i.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("p",{className:"text-sm font-medium text-blue-900",children:l}),o&&(0,i.jsx)(U.E,{variant:"outline",className:"text-sm",children:o})]}),void 0!==r&&(0,i.jsx)(W,{progress:r,className:"max-w-xs"})]})]}):null}function H(e){let{isLoading:t,children:a,loadingText:s,className:l}=e;return(0,i.jsxs)("div",{className:(0,E.cn)("flex items-center space-x-2",l),children:[t&&(0,i.jsx)(B,{size:"sm"}),(0,i.jsx)("span",{children:t&&s?s:a})]})}class J{static async optimizeImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={...this.DEFAULT_OPTIONS,...t},i=e.size;try{let t=await this.loadImage(e),s={width:t.width,height:t.height},l=this.calculateOptimalDimensions(s,a.maxWidth,a.maxHeight),r=document.createElement("canvas"),o=r.getContext("2d");if(!o)throw Error("Failed to get canvas context");r.width=l.width,r.height=l.height,o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.drawImage(t,0,0,l.width,l.height);let n=this.FORMAT_MIME_TYPES[a.format],c=await this.canvasToBlob(r,n,a.quality),d=i>0?(i-c.size)/i:0;return I.Rm.info("Image optimization completed",{component:"ImageOptimizer",action:"optimize-image",originalSize:i,optimizedSize:c.size,compressionRatio:Math.round(100*d),originalDimensions:s,newDimensions:l}),{blob:c,originalSize:i,optimizedSize:c.size,compressionRatio:d,dimensions:l,format:a.format}}catch(t){throw I.Rm.error("Image optimization failed",{component:"ImageOptimizer",action:"optimize-image",fileName:e.name,fileSize:e.size},t),t}}static async getImageMetadata(e){try{let t=await this.loadImage(e);return{width:t.width,height:t.height,size:e.size,format:e.type,aspectRatio:t.width/t.height}}catch(t){throw I.Rm.error("Failed to extract image metadata",{component:"ImageOptimizer",action:"get-metadata",fileName:e.name},t),t}}static isImageFile(e){return e.type.startsWith("image/")}static getSuggestedOptimizations(e){let{width:t,height:a,size:i}=e;return i>5242880?{maxWidth:1200,maxHeight:800,quality:.75,format:"jpeg"}:t>3e3||a>3e3?{maxWidth:1920,maxHeight:1080,quality:.8,format:"jpeg"}:t>1500||a>1500?{maxWidth:1500,maxHeight:1500,quality:.85,format:"jpeg"}:{maxWidth:t,maxHeight:a,quality:.9,format:"jpeg"}}static loadImage(e){return new Promise((t,a)=>{let i=new Image,s=URL.createObjectURL(e);i.onload=()=>{URL.revokeObjectURL(s),t(i)},i.onerror=()=>{URL.revokeObjectURL(s),a(Error("Failed to load image"))},i.src=s})}static calculateOptimalDimensions(e,t,a){let i=e.width/e.height,s=e.width,l=e.height;return s>t&&(l=(s=t)/i),l>a&&(s=(l=a)*i),{width:Math.round(s),height:Math.round(l)}}static canvasToBlob(e,t,a){return new Promise((i,s)=>{e.toBlob(e=>{e?i(e):s(Error("Failed to create blob from canvas"))},t,a)})}}function G(e){if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]}function Y(e,t){return 0===e?0:Math.round((e-t)/e*100)}function Z(e){return e.size>1048576||function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0xa00000;return e.size>t}(e,2097152)}J.DEFAULT_OPTIONS={maxWidth:1920,maxHeight:1080,quality:.85,format:"jpeg",progressive:!0},J.FORMAT_MIME_TYPES={jpeg:"image/jpeg",png:"image/png",webp:"image/webp"};let $=n.Ikc({title:n.YjP().min(1,"Album name is required").max(200,"Album name must be less than 200 characters"),description:n.YjP().min(1,"Description is required").max(1e3,"Description must be less than 1000 characters"),startDate:n.YjP().optional(),endDate:n.YjP().optional()});function V(){let{user:e,profile:t,profileLoading:n}=(0,c.A)(),C=(0,l.useRouter)(),[T,E]=(0,s.useState)(null),M=k({logContext:{component:"CreateAlbumPage",action:"album-creation"}}),U=k({logContext:{component:"CreateAlbumPage",action:"file-upload"}}),B=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{optimizationOptions:t={},onProgress:a,onComplete:i,onError:l}=e,[r,o]=(0,s.useState)({isOptimizing:!1,progress:0,currentFile:0,totalFiles:0}),[n,c]=(0,s.useState)([]),d=(0,s.useRef)(null),m=(0,s.useCallback)(async e=>{if(0===e.length)return[];d.current=new AbortController;let s=[];o({isOptimizing:!0,progress:0,currentFile:0,totalFiles:e.length});try{for(let i=0;i<e.length&&!d.current.signal.aborted;i++){let r=e[i],n={isOptimizing:!0,progress:i/e.length*100,currentFile:i+1,totalFiles:e.length,currentFileName:r.name};o(n),null==a||a(n);try{if(J.isImageFile(r)){let e,a,i=r.size;if(Z(r)){let l=await J.getImageMetadata(r),o={...J.getSuggestedOptimizations(l),...t};I.Rm.info("Optimizing image",{component:"useImageOptimization",action:"optimize-single",fileName:r.name,originalSize:i,optimizationOptions:o});let n=await J.optimizeImage(r,o);e=n.blob,a=n.optimizedSize,s.push({success:!0,originalFile:r,optimizedBlob:e,originalSize:i,optimizedSize:a,compressionRatio:n.compressionRatio})}else e=r,a=r.size,s.push({success:!0,originalFile:r,optimizedBlob:e,originalSize:i,optimizedSize:a,compressionRatio:0})}else throw Error("File is not a valid image")}catch(t){let e=t instanceof Error?t.message:"Unknown error";I.Rm.error("Image optimization failed",{component:"useImageOptimization",action:"optimize-single",fileName:r.name},t),s.push({success:!1,originalFile:r,originalSize:r.size,optimizedSize:0,compressionRatio:0,error:e}),null==l||l(e,r)}}let r={isOptimizing:!1,progress:100,currentFile:e.length,totalFiles:e.length};return o(r),null==a||a(r),c(s),null==i||i(s),I.Rm.info("Image optimization batch completed",{component:"useImageOptimization",totalFiles:e.length,successfulOptimizations:s.filter(e=>e.success).length}),s}catch(e){throw I.Rm.error("Image optimization batch failed",{component:"useImageOptimization"},e),o({isOptimizing:!1,progress:0,currentFile:0,totalFiles:0}),e}},[t,a,i,l]),u=(0,s.useCallback)(async e=>(await m([e]))[0],[m]),g=(0,s.useCallback)(()=>{d.current&&(d.current.abort(),o({isOptimizing:!1,progress:0,currentFile:0,totalFiles:0}),I.Rm.info("Image optimization cancelled",{component:"useImageOptimization"}))},[]),p=(0,s.useCallback)(()=>{if(0===n.length)return null;let e=n.filter(e=>e.success),t=e.reduce((e,t)=>e+t.originalSize,0),a=e.reduce((e,t)=>e+t.optimizedSize,0),i=t-a,s=e.length>0?e.reduce((e,t)=>e+t.compressionRatio,0)/e.length:0;return{totalFiles:n.length,successfulOptimizations:e.length,failedOptimizations:n.length-e.length,totalOriginalSize:t,totalOptimizedSize:a,totalSavings:i,averageCompression:Math.round(100*s),formattedSavings:G(i),formattedOriginalSize:G(t),formattedOptimizedSize:G(a)}},[n]);return{progress:r,results:n,isOptimizing:r.isOptimizing,optimizeImages:m,optimizeSingleImage:u,cancelOptimization:g,getOptimizationSummary:p,formatFileSize:G,getCompressionPercentage:Y,shouldOptimizeImage:e=>Z(e)}}({autoOptimize:!0,optimizationOptions:{maxWidth:1920,maxHeight:1080,quality:.85,format:"jpeg"},onProgress:e=>{e.isOptimizing&&U.updateProgress("Optimizing ".concat(e.currentFileName,"... (").concat(e.currentFile,"/").concat(e.totalFiles,")"),e.progress)},onComplete:()=>{let e=B.getOptimizationSummary();e&&e.totalSavings>0&&I.Rm.info("Image optimization completed",{component:"CreateAlbumPage",action:"optimize-images",totalSavings:e.formattedSavings,averageCompression:e.averageCompression})}}),[W,V]=(0,s.useState)([]),[X,K]=(0,s.useState)(null),Q=(0,d.UU)(),{register:ee,handleSubmit:et,formState:{errors:ea},watch:ei,setValue:es}=(0,r.mN)({resolver:(0,o.u)($),defaultValues:{title:"",description:"",startDate:"",endDate:""}}),el=ei("startDate"),er=ei("endDate"),eo=async e=>{try{let t=await a.e(7573).then(a.bind(a,17573)),i=await t.parse(e);return{dateTime:(null==i?void 0:i.DateTime)||(null==i?void 0:i.DateTimeOriginal),latitude:null==i?void 0:i.latitude,longitude:null==i?void 0:i.longitude,cameraMake:null==i?void 0:i.Make,cameraModel:null==i?void 0:i.Model}}catch(t){return I.Rm.warn("EXIF extraction failed for photo",{component:"CreateAlbumPage",action:"extract-exif",fileName:e.name},t),{}}},en=(0,s.useCallback)(async e=>{if(0!==e.length){U.startLoading("Optimizing images...",[{key:"optimizing",text:"Optimizing images...",weight:60},{key:"processing",text:"Processing metadata...",weight:40}]);try{let t=await B.optimizeImages(e);U.nextStage("Processing metadata...");let a=[];for(let e=0;e<t.length;e++){let i=t[e];if(i.success&&i.optimizedBlob){let e=new File([i.optimizedBlob],i.originalFile.name,{type:i.optimizedBlob.type}),t=URL.createObjectURL(i.optimizedBlob),s=await eo(i.originalFile);a.push({file:e,preview:t,caption:"",manualLocation:null,exifData:s,uploadProgress:0,uploadStatus:"pending",originalSize:i.originalSize,optimizedSize:i.optimizedSize,compressionRatio:i.compressionRatio})}else{let e=i.originalFile,t=URL.createObjectURL(e),s=await eo(e);a.push({file:e,preview:t,caption:"",manualLocation:null,exifData:s,uploadProgress:0,uploadStatus:"pending",optimizationError:i.error})}}V(e=>[...e,...a]),U.completeLoading("Images optimized successfully!");let i=B.getOptimizationSummary();i&&i.totalSavings>1e5&&I.Rm.info("Image optimization saved ".concat(i.formattedSavings),{component:"CreateAlbumPage",action:"image-optimization-summary",averageCompression:i.averageCompression})}catch(a){U.errorLoading("Failed to optimize images"),I.Rm.error("Image optimization failed in onDrop",{component:"CreateAlbumPage",action:"optimize-on-drop"},a);let t=[];for(let a of e){let e=URL.createObjectURL(a),i=await eo(a);t.push({file:a,preview:e,caption:"",manualLocation:null,exifData:i,uploadProgress:0,uploadStatus:"pending"})}V(e=>[...e,...t])}}},[B,U]),{getRootProps:ec,getInputProps:ed,isDragActive:em}=(0,O.VB)({onDrop:en,accept:{"image/*":[".jpeg",".jpg",".png",".webp",".heic"]},multiple:!0}),eu=async(t,a,i)=>{try{var s,l,r,o,n,c,d,m,u,g,p,h,x;V(e=>{let t=[...e];return t[i].uploadStatus="uploading",t[i].uploadProgress=0,t[i].uploadError=void 0,t});let f=await (0,D.gN)(t.file,null==e?void 0:e.id),b=null!=(g=null!=(u=null==(s=t.manualLocation)?void 0:s.latitude)?u:null==(l=t.exifData)?void 0:l.latitude)?g:null,y=null!=(h=null!=(p=null==(r=t.manualLocation)?void 0:r.longitude)?p:null==(o=t.exifData)?void 0:o.longitude)?h:null,j=null!=(x=null==(n=t.manualLocation)?void 0:n.display_name)?x:null,{error:v}=await Q.from("photos").insert({album_id:a,user_id:null==e?void 0:e.id,file_path:f,caption:t.caption||null,order_index:i,taken_at:(null==(c=t.exifData)?void 0:c.dateTime)||null,latitude:b,longitude:y,file_size:t.file.size,exif_data:{cameraMake:(null==(d=t.exifData)?void 0:d.cameraMake)||null,cameraModel:(null==(m=t.exifData)?void 0:m.cameraModel)||null,mimeType:t.file.type,locationName:j,originalFileName:t.file.name}});if(v)throw v;return V(e=>{let t=[...e];return t[i].uploadStatus="completed",t[i].uploadProgress=100,t}),!0}catch(a){let e=(0,R.Et)(a,{component:"CreateAlbumPage",action:"upload-photo",fileName:t.file.name,fileSize:t.file.size});return V(t=>{let a=[...t];return a[i].uploadStatus="error",a[i].uploadError=e.userMessage,a}),!1}},eg=async a=>{if(e){if(!t){E("Profile not found. Please complete your profile setup first."),I.Rm.error("Album creation failed - missing profile",{component:"CreateAlbumPage",action:"form-create-album",userId:e.id,profileExists:!!t}),C.push("/setup?reason=missing-profile");return}try{if(E(null),M.startLoading("Creating album...",_.ALBUM_CREATION),M.nextStage("Creating album..."),!X)throw Error("Please select a location for your album");let t={user_id:e.id,title:a.title,description:a.description,location_name:X.display_name,latitude:X.latitude,longitude:X.longitude,city_id:X.city_id||null,country_id:X.country_id||null,country_code:X.country_code||null,start_date:a.startDate||null,end_date:a.endDate||null,visibility:"public",tags:null},{data:i,error:s}=await Q.from("albums").insert([t]).select().single();if(s)throw s;if(W.length>0){M.nextStage("Uploading ".concat(W.length," photos..."));let e=0,t=W.map((e,t)=>eu(e,i.id,t));(e=(await Promise.all(t)).filter(Boolean).length)<W.length&&E("Album created! ".concat(e,"/").concat(W.length," photos uploaded successfully. You can add more photos later."))}M.nextStage("Finalizing album..."),M.completeLoading("Album created successfully!"),C.push("/albums/".concat(i.id))}catch(i){let t=(0,R.NC)(i,{component:"CreateAlbumPage",action:"create-album",userId:null==e?void 0:e.id,albumTitle:a.title});M.errorLoading(t.userMessage),E(t.userMessage)}}};return n?(0,i.jsx)("div",{className:"max-w-2xl mx-auto space-y-8",children:(0,i.jsx)(m.Zp,{children:(0,i.jsx)(m.Wu,{className:"pt-6",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,i.jsx)("p",{className:"mt-2 text-sm text-gray-800",children:"Loading profile..."})]})})})}):e&&!t?(0,i.jsx)("div",{className:"max-w-2xl mx-auto space-y-8",children:(0,i.jsx)(m.Zp,{className:"border-yellow-200 bg-yellow-50",children:(0,i.jsx)(m.Wu,{className:"pt-6",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(f.A,{className:"h-12 w-12 text-yellow-600 mx-auto mb-4"}),(0,i.jsx)("h3",{className:"text-lg font-semibold text-yellow-900 mb-2",children:"Profile Setup Required"}),(0,i.jsx)("p",{className:"text-yellow-700 mb-4",children:"You need to complete your profile setup before creating albums."}),(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,i.jsx)(F(),{href:"/setup",children:(0,i.jsx)(u.$,{children:"Complete Profile Setup"})}),(0,i.jsx)(F(),{href:"/albums",children:(0,i.jsx)(u.$,{variant:"outline",children:"Back to Albums"})})]})]})})})}):(0,i.jsxs)("div",{className:"max-w-2xl mx-auto space-y-8",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)(F(),{href:"/albums",className:"inline-flex items-center text-sm text-gray-800 hover:text-gray-900 mb-4",children:[(0,i.jsx)(b.A,{className:"h-4 w-4 mr-1"}),"Back to Albums"]}),(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Create New Adventure"}),(0,i.jsx)("p",{className:"text-gray-800 mt-2",children:"Create an album and automatically add a pin to your adventure globe"})]}),(0,i.jsxs)("form",{onSubmit:et(eg),className:"space-y-6",children:[(0,i.jsxs)(m.Zp,{children:[(0,i.jsxs)(m.aR,{children:[(0,i.jsx)(m.ZB,{children:"Create Adventure Album"}),(0,i.jsx)(m.BT,{children:"Create a simple album that will automatically add a pin to your globe"})]}),(0,i.jsxs)(m.Wu,{className:"space-y-6",children:[(0,i.jsx)(q,{loadingState:M}),T&&(0,i.jsx)("div",{className:"p-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded-md",children:T}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(p.J,{htmlFor:"title",children:"Album Name *"}),(0,i.jsx)(g.p,{id:"title",placeholder:"e.g., Summer Trip to Italy",...ee("title"),className:ea.title?"border-red-500":""}),ea.title&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:ea.title.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(p.J,{htmlFor:"description",children:"Description *"}),(0,i.jsx)(h.T,{id:"description",placeholder:"Tell the story of your adventure...",rows:4,...ee("description"),className:ea.description?"border-red-500":""}),ea.description&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:ea.description.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(p.J,{htmlFor:"location_name",children:"Location (City & Country) *"}),(0,i.jsx)(A.f,{value:X,onChange:K,placeholder:"Search for a city or country...",allowCurrentLocation:!0,showPopularDestinations:!0}),!X&&(0,i.jsx)("p",{className:"text-sm text-gray-800",children:"Select a location to automatically add a pin to your globe"}),X&&(0,i.jsxs)("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 text-green-800 font-medium mb-1",children:[(0,i.jsx)(y.A,{className:"h-4 w-4"}),"Selected: ",X.display_name]}),(0,i.jsx)("p",{className:"text-green-700 text-sm",children:"âœ… This will automatically add a pin to your globe at this location"})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(p.J,{children:"Travel Dates (Optional)"}),(0,i.jsx)("p",{className:"text-sm text-gray-800 mb-3",children:"Add dates to see your adventure on the globe timeline"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(p.J,{htmlFor:"startDate",children:"Start Date"}),(0,i.jsx)(g.p,{id:"startDate",type:"date",...ee("startDate"),max:er||void 0,className:ea.startDate?"border-red-500":""}),ea.startDate&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:ea.startDate.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(p.J,{htmlFor:"endDate",children:"End Date"}),(0,i.jsx)(g.p,{id:"endDate",type:"date",...ee("endDate"),min:el||void 0,className:ea.endDate?"border-red-500":""}),ea.endDate&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:ea.endDate.message})]})]}),W.length>0&&(0,i.jsxs)(u.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{if(0===W.length)return;let e=W.map(e=>{var t;return null==(t=e.exifData)?void 0:t.dateTime}).filter(Boolean).map(e=>new Date(e)).sort((e,t)=>e.getTime()-t.getTime());if(e.length>0){let t=e[0].toISOString().split("T")[0],a=e[e.length-1].toISOString().split("T")[0];es("startDate",t),es("endDate",a)}},className:"mt-2",children:[(0,i.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Use Photo Dates"]})]})]})]}),(0,i.jsxs)(m.Zp,{children:[(0,i.jsxs)(m.aR,{children:[(0,i.jsxs)(m.ZB,{className:"flex items-center gap-2",children:[(0,i.jsx)(v.A,{className:"h-5 w-5"}),"Photos (Optional)"]}),(0,i.jsx)(m.BT,{children:"Add photos to your album now, or upload them later"})]}),(0,i.jsxs)(m.Wu,{className:"space-y-6",children:[(0,i.jsxs)("div",{...ec(),className:"\n                border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors\n                ".concat(em?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400","\n              "),children:[(0,i.jsx)("input",{...ed()}),(0,i.jsx)(N.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-700"}),em?(0,i.jsx)("p",{className:"text-lg font-medium text-blue-600",children:"Drop photos here..."}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"Drag photos here or click to browse"}),(0,i.jsx)("p",{className:"text-sm text-gray-800",children:"JPEG, PNG, WebP, and HEIC formats supported. EXIF data will be extracted automatically."})]})]}),W.length>0&&(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("h4",{className:"font-medium text-gray-900",children:["Photos (",W.length,")"]}),W.some(e=>"uploading"===e.uploadStatus)&&(0,i.jsx)("div",{className:"text-sm text-blue-600",children:"Uploading photos..."})]}),(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:W.map((e,t)=>{var a,s,l,r;return(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"relative group",children:[(0,i.jsx)("div",{className:"relative w-full h-32 rounded-lg overflow-hidden",children:(0,i.jsx)(L.default,{src:e.preview,alt:"Upload ".concat(t+1),fill:!0,className:"object-cover"})}),(0,i.jsx)("button",{type:"button",onClick:()=>{V(e=>{let a=[...e];return URL.revokeObjectURL(a[t].preview),a.splice(t,1),a})},className:"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",disabled:W.some(e=>"uploading"===e.uploadStatus),children:(0,i.jsx)(w.A,{className:"h-4 w-4"})}),(0,i.jsxs)("div",{className:"absolute bottom-2 left-2 flex items-center gap-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm",children:["pending"===e.uploadStatus&&(0,i.jsx)(v.A,{className:"h-3 w-3 text-gray-700"}),"uploading"===e.uploadStatus&&(0,i.jsx)(S.A,{className:"h-3 w-3 text-blue-600 animate-pulse"}),"completed"===e.uploadStatus&&(0,i.jsx)(z.A,{className:"h-3 w-3 text-green-600"}),"error"===e.uploadStatus&&(0,i.jsx)(f.A,{className:"h-3 w-3 text-red-600"}),(0,i.jsx)("span",{className:"capitalize",children:e.uploadStatus})]})]}),"uploading"===e.uploadStatus&&(0,i.jsx)(x.k,{value:e.uploadProgress,className:"w-full"}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(p.J,{htmlFor:"caption-".concat(t),className:"text-sm",children:"Caption"}),(0,i.jsx)(h.T,{id:"caption-".concat(t),value:e.caption,onChange:e=>{var a;return a=e.target.value,void V(e=>{let i=[...e];return i[t].caption=a,i})},placeholder:"Add a caption...",rows:2,disabled:W.some(e=>"uploading"===e.uploadStatus),className:"text-sm"})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(p.J,{className:"text-sm",children:"Location"}),(0,i.jsx)(P.C,{value:e.manualLocation,onChange:e=>{V(a=>{let i=[...a];return i[t].manualLocation=e,i})},placeholder:(null==(a=e.exifData)?void 0:a.latitude)&&(null==(s=e.exifData)?void 0:s.longitude)?"Override GPS location...":"Search for location...",allowCurrentLocation:!0}),(null==(l=e.exifData)?void 0:l.latitude)&&(null==(r=e.exifData)?void 0:r.longitude)&&!e.manualLocation&&(0,i.jsx)("p",{className:"text-sm text-gray-800",children:"\uD83D\uDCCD GPS location detected from photo"})]}),"error"===e.uploadStatus&&e.uploadError&&(0,i.jsx)("div",{className:"bg-red-50 border border-red-200 rounded p-2",children:(0,i.jsx)("p",{className:"text-red-600 text-sm",children:e.uploadError})})]},t)})})]})]})]}),(0,i.jsxs)("div",{className:"flex gap-4",children:[(0,i.jsx)(F(),{href:"/albums",className:"flex-1",children:(0,i.jsx)(u.$,{variant:"outline",className:"w-full",disabled:M.isLoading,children:"Cancel"})}),(0,i.jsx)(u.$,{type:"submit",className:"flex-1",disabled:M.isLoading||!X,children:(0,i.jsx)(H,{isLoading:M.isLoading,loadingText:M.loadingText,children:"Create Album & Add Globe Pin"})})]})]})]})}},39068:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});let i=(0,a(71847).A)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]])},50246:(e,t,a)=>{"use strict";a.d(t,{C:()=>h});var i=a(95155),s=a(12115),l=a(3998),r=a(65142),o=a(86948),n=a(86651),c=a(65229),d=a(35299),m=a(76561),u=a(21873),g=a(64269),p=a(82466);function h(e){let{value:t,onChange:a,placeholder:h="Search for a location...",className:x,allowCurrentLocation:f=!0}=e,[b,y]=(0,s.useState)(""),[j,v]=(0,s.useState)([]),[N,w]=(0,s.useState)(!1),[S,z]=(0,s.useState)(!1),[C,F]=(0,s.useState)(!1),[L,O]=(0,s.useState)(null),[P,A]=(0,s.useState)(0),I=(0,s.useRef)(null),D=(0,s.useRef)(null);(0,s.useEffect)(()=>{(null==t?void 0:t.display_name)?y(t.display_name):y("")},[t]);let R=(0,s.useCallback)(async e=>{if(e.trim()){w(!0),O(null);try{let t=await fetch("https://nominatim.openstreetmap.org/search?"+new URLSearchParams({q:e,format:"json",limit:"10",dedupe:"1","accept-language":"en"}));if(!t.ok)throw Error("Failed to search locations");let a=await t.json();v(a),z(!0)}catch(t){p.Rm.error("Location search error",{},t),t instanceof TypeError&&t.message.includes("fetch")&&P<3?(A(e=>e+1),setTimeout(()=>R(e),1e3*(P+1)),O("Connection failed, retrying... (".concat(P+1,"/").concat(3,")"))):(O("Failed to search locations. Please check your internet connection and try again."),v([]))}finally{w(!1)}}},[P,3]);return(0,s.useEffect)(()=>(I.current&&clearTimeout(I.current),b.length>=3?I.current=setTimeout(()=>{R(b)},500):(v([]),z(!1)),()=>{I.current&&clearTimeout(I.current)}),[b,R]),(0,i.jsxs)("div",{className:(0,g.cn)("relative",x),children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)("div",{className:"relative flex-1",children:[(0,i.jsx)(n.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-700"}),(0,i.jsx)(r.p,{ref:D,type:"text",value:b,onChange:e=>{let t=e.target.value;y(t),t.trim()||(a(null),z(!1))},placeholder:h,className:"pl-10 pr-10",onFocus:()=>{j.length>0&&z(!0)}}),b&&(0,i.jsx)("button",{type:"button",onClick:()=>{var e;a(null),y(""),z(!1),null==(e=D.current)||e.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-100 rounded",children:(0,i.jsx)(c.A,{className:"h-3 w-3 text-gray-700"})}),N&&(0,i.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:(0,i.jsx)(d.A,{className:"h-4 w-4 animate-spin text-gray-700"})})]}),f&&(0,i.jsx)(l.$,{type:"button",variant:"outline",size:"icon",onClick:()=>{if(!navigator.geolocation)return void O("Geolocation is not supported by your browser");F(!0),O(null),navigator.geolocation.getCurrentPosition(async e=>{let{latitude:t,longitude:i}=e.coords;try{let e=await fetch("https://nominatim.openstreetmap.org/reverse?"+new URLSearchParams({lat:t.toString(),lon:i.toString(),format:"json","accept-language":"en"}));if(e.ok){let s=await e.json(),l={latitude:t,longitude:i,display_name:s.display_name||"".concat(t.toFixed(6),", ").concat(i.toFixed(6)),place_id:s.place_id};a(l),y(l.display_name),z(!1)}else{let e={latitude:t,longitude:i,display_name:"".concat(t.toFixed(6),", ").concat(i.toFixed(6))};a(e),y(e.display_name),z(!1)}}catch(s){p.Rm.error("Reverse geocoding error",{},s);let e={latitude:t,longitude:i,display_name:"".concat(t.toFixed(6),", ").concat(i.toFixed(6))};a(e),y(e.display_name),z(!1)}F(!1)},e=>{p.Rm.error("Geolocation error",{errorCode:e.code,errorMessage:e.message});let t="Failed to get your current location";switch(e.code){case e.PERMISSION_DENIED:t="Location access denied. Please enable location permissions.";break;case e.POSITION_UNAVAILABLE:t="Location information unavailable. Please try again.";break;case e.TIMEOUT:t="Location request timed out. Please try again.";break;default:t="Failed to get your current location. Please try again."}O(t),F(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},disabled:C,title:"Use current location",children:C?(0,i.jsx)(d.A,{className:"h-4 w-4 animate-spin"}):(0,i.jsx)(m.A,{className:"h-4 w-4"})})]}),L&&(0,i.jsx)("div",{className:"flex items-start gap-2 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-600",children:(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("p",{children:L}),L.includes("internet connection")&&(0,i.jsx)("button",{onClick:()=>{O(null),A(0),b.length>=3&&R(b)},className:"mt-1 text-red-700 underline hover:no-underline",children:"Try again"})]})}),t&&(0,i.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-800",children:[(0,i.jsx)(u.A,{className:"h-3 w-3"}),(0,i.jsxs)("span",{children:[t.latitude.toFixed(6),", ",t.longitude.toFixed(6)]})]})]}),S&&j.length>0&&(0,i.jsx)(o.Zp,{className:"absolute top-full left-0 right-0 z-50 mt-1 max-h-80 overflow-auto",children:(0,i.jsx)(o.Wu,{className:"p-2",children:j.map(e=>{var t;return(0,i.jsx)("button",{type:"button",className:"w-full text-left p-3 hover:bg-gray-50 rounded-md transition-colors",onClick:()=>{var t;a({latitude:parseFloat(e.lat),longitude:parseFloat(e.lon),display_name:e.display_name,place_id:e.place_id}),y(e.display_name),z(!1),null==(t=D.current)||t.blur()},children:(0,i.jsxs)("div",{className:"flex items-start gap-3",children:[(0,i.jsx)(u.A,{className:"h-4 w-4 text-gray-700 mt-0.5 flex-shrink-0"}),(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsx)("p",{className:"font-medium text-gray-900 line-clamp-1",children:(t=e.display_name).length>60?t.substring(0,60)+"...":t}),(0,i.jsxs)("p",{className:"text-sm text-gray-800",children:[parseFloat(e.lat).toFixed(4),", ",parseFloat(e.lon).toFixed(4)]})]})]})},e.place_id)})})}),S&&0===j.length&&b.length>=3&&!N&&(0,i.jsx)(o.Zp,{className:"absolute top-full left-0 right-0 z-50 mt-1",children:(0,i.jsxs)(o.Wu,{className:"p-4 text-center",children:[(0,i.jsxs)("p",{className:"text-gray-800",children:['No locations found for "',b,'"']}),(0,i.jsx)("p",{className:"text-sm text-gray-800 mt-1",children:"Try a different search term"})]})})]})}},78928:(e,t,a)=>{Promise.resolve().then(a.bind(a,16032))},80991:(e,t,a)=>{"use strict";a.d(t,{k:()=>o});var i=a(95155),s=a(12115),l=a(9484),r=a(64269);let o=s.forwardRef((e,t)=>{let{className:a,value:s,...o}=e;return(0,i.jsx)(l.bL,{ref:t,className:(0,r.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...o,children:(0,i.jsx)(l.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(s||0),"%)")}})})});o.displayName=l.bL.displayName}},e=>{e.O(0,[4545,7559,2619,2738,2784,2313,6869,3147,9029,8441,1255,7358],()=>e(e.s=78928)),_N_E=e.O()}]);