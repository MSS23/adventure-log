(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2213],{11647:(e,t,a)=>{"use strict";a.d(t,{E:()=>r});var n=a(95155);a(12115);var i=a(83101),l=a(64269);let s=(0,i.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-sm font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function r(e){let{className:t,variant:a,...i}=e;return(0,n.jsx)("div",{className:(0,l.cn)(s({variant:a}),t),...i})}},40265:(e,t,a)=>{Promise.resolve().then(a.bind(a,79910))},62890:(e,t,a)=>{"use strict";a.d(t,{UU:()=>s});var n=a(87559);a(95704);let i="https://jjrqstbzzvqrgaqwdvxw.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpqcnFzdGJ6enZxcmdhcXdkdnh3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0ODc4MDcsImV4cCI6MjA3NDA2MzgwN30.aSHFHAA5Tv2EUDu7nxwOWXSFFUxbOUCR65Vi52QkjX4";if(!i||!l)throw Error("Missing Supabase environment variables");function s(){return(0,n.createBrowserClient)(i,l)}},65142:(e,t,a)=>{"use strict";a.d(t,{p:()=>l});var n=a(95155);a(12115);var i=a(64269);function l(e){let{className:t,type:a,...l}=e;return(0,n.jsx)("input",{type:a,"data-slot":"input",className:(0,i.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...l})}},79910:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ea});var n=a(95155),i=a(12115),l=a(67909),s=a(62890),r=a(43691);function o(e){if(e){if(Array.isArray(e)){var t;return null==(t=e[0])?void 0:t.privacy_level}return e.privacy_level}}var c=a(82466);function u(e){return Math.PI/180*e}function d(e){return 180/Math.PI*e}function h(e,t){let a=u(e.latitude),n=u(e.longitude),i=u(t.latitude),l=Math.sin((i-a)/2)**2+Math.cos(a)*Math.cos(i)*Math.sin((u(t.longitude)-n)/2)**2;return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371}function m(e,t){let a=u(e.latitude),n=u(t.latitude),i=u(t.longitude-e.longitude);return(d(Math.atan2(Math.sin(i)*Math.cos(n),Math.cos(a)*Math.sin(n)-Math.sin(a)*Math.cos(n)*Math.cos(i)))+360)%360}function g(e,t,a){let n=u(e.latitude),i=u(e.longitude),l=u(t.latitude),s=u(t.longitude),r=h(e,t)/6371,o=Math.sin((1-a)*r)/Math.sin(r),c=Math.sin(a*r)/Math.sin(r),m=o*Math.cos(n)*Math.cos(i)+c*Math.cos(l)*Math.cos(s),g=o*Math.cos(n)*Math.sin(i)+c*Math.cos(l)*Math.sin(s),x=Math.atan2(o*Math.sin(n)+c*Math.sin(l),Math.sqrt(m*m+g*g)),p=Math.atan2(g,m),f=Math.sin(a*Math.PI);return{lat:d(x),lng:d(p),altitude:.02*f}}class x{setTimeline(e,t){this.timeline=e.filter(e=>e.year===t).sort((e,t)=>e.sequenceOrder-t.sequenceOrder),this.currentYear=t,this.reset()}play(){this.isPlaying=!0,this.animate()}pause(){this.isPlaying=!1}reset(){this.currentSegmentIndex=0,this.segmentProgress=0,this.isPlaying=!1}setSpeed(e){this.animationSpeed=Math.max(.1,Math.min(5,e))}seekToSegment(e){this.currentSegmentIndex=Math.max(0,Math.min(e,this.timeline.length-2)),this.segmentProgress=0}animate(){var e,t,a,n;if(!this.isPlaying||this.timeline.length<2)return;let i=this.timeline[this.currentSegmentIndex],l=this.timeline[this.currentSegmentIndex+1];if(!i||!l){this.isPlaying=!1;return}let s={latitude:i.latitude,longitude:i.longitude},r={latitude:l.latitude,longitude:l.longitude},o=(.005+.015*Math.min(h(s,r)/15e3,1))*this.animationSpeed;this.segmentProgress=Math.min(this.segmentProgress+.016*o,1);let c=(n=this.segmentProgress)*n*(3-2*n),u=g(s,r,c),d=this.segmentProgress<.99?g(s,r,c+.01):u,x=function(e,t,a){let n=m({latitude:e.lat,longitude:e.lng},{latitude:t.lat,longitude:t.lng}),i=Math.max(-30,Math.min(30,.5*((n-a+540)%360-180)));return{heading:n,pitch:Math.max(-15,Math.min(15,180/Math.PI*Math.atan2((t.altitude||0)-(e.altitude||0),.1))),bank:i}}(u,d,m(s,r)),p={position:u,rotation:x,speed:o*this.animationSpeed};null==(e=this.onPositionUpdate)||e.call(this,p);let f=function(e,t,a){if(!(a<.5))return{lat:t.lat,lng:t.lng,altitude:.12};{let n=Math.min(a+.1,1),i=g({latitude:e.lat,longitude:e.lng},{latitude:t.lat,longitude:t.lng},n);return{lat:i.lat,lng:i.lng,altitude:Math.max(.15,i.altitude||.1)}}}(u,{lat:r.latitude,lng:r.longitude,altitude:0},c);if(null==(t=this.onCameraUpdate)||t.call(this,f),this.segmentProgress>=1&&(null==(a=this.onSegmentComplete)||a.call(this,l),this.currentSegmentIndex++,this.segmentProgress=0,this.currentSegmentIndex>=this.timeline.length-1)){this.isPlaying=!1;return}this.isPlaying&&requestAnimationFrame(()=>this.animate())}getCurrentSegment(){return this.timeline[this.currentSegmentIndex]||null}getProgress(){let e=Math.max(this.timeline.length-1,1),t=this.currentSegmentIndex+this.segmentProgress;return{segment:this.currentSegmentIndex,total:e,percentage:t/e*100}}getTotalDuration(){let e=0;for(let t=0;t<this.timeline.length-1;t++){let a=this.timeline[t],n=this.timeline[t+1];e+=Math.max(h({latitude:a.latitude,longitude:a.longitude},{latitude:n.latitude,longitude:n.longitude})/800,2)}return e/this.animationSpeed}constructor(e,t,a){this.timeline=[],this.currentSegmentIndex=0,this.segmentProgress=0,this.isPlaying=!1,this.animationSpeed=1,this.currentYear=null,this.onPositionUpdate=e,this.onCameraUpdate=t,this.onSegmentComplete=a}}class p{static toRadians(e){return Math.PI/180*e}static toDegrees(e){return 180/Math.PI*e}static calculateDistance(e,t){let a=this.toRadians(e.lat),n=this.toRadians(e.lng),i=this.toRadians(t.lat),l=Math.sin((i-a)/2)**2+Math.cos(a)*Math.cos(i)*Math.sin((this.toRadians(t.lng)-n)/2)**2;return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371}static calculateBearing(e,t){let a=this.toRadians(e.lat),n=this.toRadians(t.lat),i=this.toRadians(t.lng-e.lng),l=Math.atan2(Math.sin(i)*Math.cos(n),Math.cos(a)*Math.sin(n)-Math.sin(a)*Math.cos(n)*Math.cos(i));return(this.toDegrees(l)+360)%360}static generateFlightPath(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=this.calculateDistance(e,t),i=this.calculateBearing(e,t),l=Math.min(8e3,Math.max(3e3,50*n)),s=this.generateGreatCircleWaypoints(e,t,a);return{start:e,end:t,distance:n,duration:l,waypoints:s,bearing:i,estimatedFlightTime:n/900}}static generateGreatCircleWaypoints(e,t,a){let n=[],i=this.toRadians(e.lat),l=this.toRadians(e.lng),s=this.toRadians(t.lat),r=this.toRadians(t.lng),o=this.calculateDistance(e,t)/6371;for(let e=0;e<=a;e++){let t=e/a,c=Math.sin((1-t)*o)/Math.sin(o),u=Math.sin(t*o)/Math.sin(o),d=c*Math.cos(i)*Math.cos(l)+u*Math.cos(s)*Math.cos(r),h=c*Math.cos(i)*Math.sin(l)+u*Math.cos(s)*Math.sin(r),m=Math.atan2(c*Math.sin(i)+u*Math.sin(s),Math.sqrt(d*d+h*h)),g=Math.atan2(h,d);n.push({lat:this.toDegrees(m),lng:this.toDegrees(g)})}return n}static generateFlightSegments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60,a=[],n=Math.floor(e.duration/1e3*t);for(let i=0;i<=n;i++){let l=i/n,s=Math.floor(l*(e.waypoints.length-1)),r=l*(e.waypoints.length-1)%1,o=e.waypoints[s],c=e.waypoints[Math.min(s+1,e.waypoints.length-1)],u=o.lat+(c.lat-o.lat)*r,d=o.lng+(c.lng-o.lng)*r,h=this.calculateAltitude(l,e.distance),m=this.calculateBearing(o,c);a.push({lat:u,lng:d,altitude:h,progress:l,heading:m,timestamp:i/t*1e3})}return a}static calculateAltitude(e,t){let a=t<500?.012:.02;return e<.1?e/.1*a:e>.9?(1-e)/.1*a:a}static calculateAirplaneRotation(e,t,a){let n=this.calculatePitch(e,a);return{pitch:n,yaw:e.heading,roll:this.calculateRoll(e,t)}}static calculatePitch(e,t){return t?180/Math.PI*Math.atan2(t.altitude-e.altitude,.001):0}static calculateRoll(e,t){if(!t)return 0;let a=e.heading-t.heading;return a>180&&(a-=360),a<-180&&(a+=360),Math.max(-30,Math.min(30,2*a))}static generateYearFlightPaths(e){let t=e.sort((e,t)=>e.date.getTime()-t.date.getTime()),a=[];for(let e=0;e<t.length-1;e++){let n=t[e],i=t[e+1],l=this.generateFlightPath(n,i);a.push(l)}return a}static calculateCameraPosition(e){let t=e.altitude+.5,a=this.toRadians(e.heading+180);return{lat:e.lat+.05*Math.cos(a),lng:e.lng+.05*Math.sin(a),altitude:t}}}var f=a(85339);function v(e){let{globe:t,airplaneState:a,isActive:n,trailColor:l="#00ff88",airplaneScale:s=.005}=e,r=(0,i.useRef)(null),o=(0,i.useRef)(null),[c,u]=(0,i.useState)({points:[],opacity:1,maxLength:200}),d=(0,i.useCallback)(e=>{let t=new f.LoY,a=new Float32Array(3*e.length),n=new Float32Array(3*e.length);return e.forEach((e,t)=>{a[3*t]=e.x,a[3*t+1]=e.y,a[3*t+2]=e.z;let i=new f.Q1f(l);n[3*t]=i.r,n[3*t+1]=i.g,n[3*t+2]=i.b}),t.setAttribute("position",new f.THS(a,3)),t.setAttribute("color",new f.THS(n,3)),t},[l]),h=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=100+100*a,i=Math.PI/180*(90-e),l=Math.PI/180*(t+180),s=n*Math.sin(i)*Math.cos(l),r=n*Math.cos(i),o=n*Math.sin(i)*Math.sin(l);return new f.Pq0(s,r,o)};return(0,i.useEffect)(()=>{if(!t||!n)return;let e=t.scene();if(!e)return;if(!r.current){let t=(()=>{let e=new f.YJl,t=new f.Ho_(.1,.05,2,8),a=new f.tXL({color:0xffffff}),n=new f.eaF(t,a);n.rotation.z=Math.PI/2,e.add(n);let i=new f.iNn(3,.1,.5),l=new f.tXL({color:0xcccccc}),s=new f.eaF(i,l);s.position.z=-.2,e.add(s);let r=new f.iNn(.8,.1,1.5),o=new f.tXL({color:0xcccccc}),c=new f.eaF(r,o);c.position.x=-.8,c.rotation.z=Math.PI/4,e.add(c);let u=new f.Gu$(.15,8,6),d=new f.tXL({color:3355443,transparent:!0,opacity:.8}),h=new f.eaF(u,d);h.position.x=.7,h.scale.set(1,1,.7),e.add(h);let m=new f.Ho_(.12,.12,.4,8),g=new f.tXL({color:4473924}),x=new f.eaF(m,g);x.rotation.z=Math.PI/2,x.position.set(0,.8,-.1),e.add(x);let p=new f.eaF(m,g);p.rotation.z=Math.PI/2,p.position.set(0,-.8,-.1),e.add(p);let v=new f.bdM(.8,.2),b=new f.tXL({color:8900331,transparent:!0,opacity:.6}),y=new f.eaF(v,b);return y.position.set(.2,0,.11),e.add(y),e})();t.scale.setScalar(s),r.current=t,e.add(t)}let a=new f.LoY,i=new f.mrM({vertexColors:!0,transparent:!0,opacity:.8,linewidth:2});if(!o.current){let t=new f.N1A(a,i);o.current=t,e.add(t)}return()=>{r.current&&(e.remove(r.current),r.current=null),o.current&&(e.remove(o.current),o.current=null)}},[t,n,s]),(0,i.useEffect)(()=>{if(!a||!r.current||!t)return;let{position:e,rotation:n}=a,i=r.current,l=h(e.lat,e.lng,e.altitude||.02);i.position.copy(l);let s=n.heading*Math.PI/180,o=n.pitch*Math.PI/180,c=n.bank*Math.PI/180;i.rotation.set(o,s,c),i.lookAt(l.x+Math.sin(s),l.y,l.z+Math.cos(s)),u(e=>{let t=[...e.points,l.clone()];return t.length>e.maxLength&&t.shift(),{...e,points:t}})},[a,t]),(0,i.useEffect)(()=>{if(!o.current||c.points.length<2)return;let e=d(c.points);o.current.geometry.dispose(),o.current.geometry=e,o.current.material.opacity=c.opacity;let t=setInterval(()=>{u(e=>{let t=Math.max(.3,.995*e.opacity);return{...e,opacity:t}})},100);return()=>clearInterval(t)},[c.points,d,c.opacity]),(0,i.useEffect)(()=>{n||u(e=>({...e,points:[],opacity:1}))},[n]),null}var b=a(76561),y=a(16485),w=a(21873),j=a(86651),N=a(65229),M=a(95664),C=a(26983),P=a(65142),S=a(3998),k=a(11647),I=a(86948),A=a(64269),D=a(15239);function E(e){let{data:t,onResultClick:a,onClearSearch:l,placeholder:s="Search locations, countries, or years...",maxResults:r=8,className:o}=e,[c,u]=(0,i.useState)(""),[d,h]=(0,i.useState)([]),[m,g]=(0,i.useState)(!1),[x,p]=(0,i.useState)(-1),f=(0,i.useRef)(null),v=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(c.length>=2){let e=(e=>{if(!e.trim())return[];let a=e.toLowerCase().trim();return t.filter(e=>{let t=e.name.toLowerCase().includes(a),n=e.country.toLowerCase().includes(a),i=e.tags.some(e=>e.toLowerCase().includes(a)),l=e.visitDate.includes(a);return t||n||i||l}).sort((e,t)=>{let n=e.name.toLowerCase().startsWith(a),i=t.name.toLowerCase().startsWith(a);return n&&!i?-1:!n&&i?1:t.photoCount-e.photoCount}).slice(0,r)})(c);h(e),g(e.length>0),p(-1)}else h([]),g(!1)},[c,t]),(0,i.useEffect)(()=>{let e=e=>{if(m&&0!==d.length)switch(e.key){case"ArrowDown":e.preventDefault(),p(e=>Math.min(e+1,d.length-1));break;case"ArrowUp":e.preventDefault(),p(e=>Math.max(e-1,-1));break;case"Enter":e.preventDefault(),x>=0&&d[x]&&E(d[x]);break;case"Escape":e.preventDefault(),F()}};if(m)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[m,d,x]),(0,i.useEffect)(()=>{if(x>=0&&v.current){let e=v.current.children[x];e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})}},[x]);let E=e=>{var t;u(""),g(!1),p(-1),a(e),null==(t=f.current)||t.blur()},F=()=>{var e;u(""),h([]),g(!1),p(-1),l(),null==(e=f.current)||e.focus()};return(0,n.jsxs)("div",{className:(0,A.cn)("relative w-full max-w-md",o),children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(j.A,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-700"}),(0,n.jsx)(P.p,{ref:f,type:"text",value:c,onChange:e=>u(e.target.value),placeholder:s,className:"pl-10 pr-10 bg-white/95 backdrop-blur-sm border-gray-200 focus:border-blue-500"}),c&&(0,n.jsx)(S.$,{variant:"ghost",size:"sm",onClick:F,className:"absolute right-2 top-1/2 -translate-y-1/2 h-6 w-6 p-0 hover:bg-gray-100",children:(0,n.jsx)(N.A,{className:"h-3 w-3"})})]}),m&&d.length>0&&(0,n.jsx)(I.Zp,{className:"absolute top-full mt-2 w-full z-50 shadow-lg border-gray-200 bg-white/98 backdrop-blur-sm",children:(0,n.jsxs)(I.Wu,{className:"p-0",children:[(0,n.jsx)("div",{ref:v,className:"max-h-80 overflow-y-auto",role:"listbox",children:d.map((e,t)=>(0,n.jsx)("button",{onClick:()=>E(e),className:(0,A.cn)("w-full p-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-b-0 transition-colors",x===t&&"bg-blue-50"),role:"option","aria-selected":x===t,children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[e.coverPhotoUrl&&(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(D.default,{src:e.coverPhotoUrl,alt:e.name,width:48,height:48,className:"rounded-lg object-cover"})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(e=>{switch(e.type){case"country":return(0,n.jsx)(b.A,{className:"h-4 w-4 text-blue-600"});case"year":return(0,n.jsx)(y.A,{className:"h-4 w-4 text-purple-600"});default:return(0,n.jsx)(w.A,{className:"h-4 w-4 text-green-600"})}})(e),(0,n.jsx)("span",{className:"font-medium text-gray-900 truncate",children:e.name})]}),(0,n.jsxs)("div",{className:"text-sm text-gray-800 mb-2",children:[e.country," • ",new Date(e.visitDate).toLocaleDateString("en-US",{year:"numeric",month:"short"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,n.jsxs)(k.E,{variant:"secondary",className:"text-sm",children:[(0,n.jsx)(M.A,{className:"h-3 w-3 mr-1"}),e.photoCount]}),(0,n.jsxs)(k.E,{variant:"outline",className:"text-sm",children:[(0,n.jsx)(C.A,{className:"h-3 w-3 mr-1"}),e.albumCount," album",1!==e.albumCount?"s":""]}),e.tags.slice(0,2).map(e=>(0,n.jsx)(k.E,{variant:"secondary",className:"text-sm",children:e},e))]})]})]})},e.id))}),d.length===r&&(0,n.jsxs)("div",{className:"p-3 text-center text-sm text-gray-800 border-t",children:["Showing first ",r," results. Try a more specific search."]})]})}),m&&c.length>=2&&0===d.length&&(0,n.jsx)(I.Zp,{className:"absolute top-full mt-2 w-full z-50 shadow-lg border-gray-200 bg-white/98 backdrop-blur-sm",children:(0,n.jsxs)(I.Wu,{className:"p-4 text-center text-gray-800",children:[(0,n.jsx)(j.A,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),(0,n.jsx)("p",{className:"font-medium",children:"No locations found"}),(0,n.jsx)("p",{className:"text-sm mt-1",children:"Try searching for a city, country, or year"})]})}),!c&&f.current===document.activeElement&&(0,n.jsx)(I.Zp,{className:"absolute top-full mt-2 w-full z-50 shadow-lg border-gray-200 bg-white/98 backdrop-blur-sm",children:(0,n.jsxs)(I.Wu,{className:"p-4",children:[(0,n.jsx)("div",{className:"text-sm text-gray-800 mb-3",children:"Quick search suggestions:"}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,n.jsx)(k.E,{variant:"secondary",className:"cursor-pointer hover:bg-gray-200",onClick:()=>u("2024"),children:"2024"}),(0,n.jsx)(k.E,{variant:"secondary",className:"cursor-pointer hover:bg-gray-200",onClick:()=>u("Japan"),children:"Japan"}),(0,n.jsx)(k.E,{variant:"secondary",className:"cursor-pointer hover:bg-gray-200",onClick:()=>u("beach"),children:"beach"}),(0,n.jsx)(k.E,{variant:"secondary",className:"cursor-pointer hover:bg-gray-200",onClick:()=>u("mountains"),children:"mountains"})]})]})})]})}var F=a(58415),z=a(24342),L=a(83457),R=a(90368),_=a(27937),U=a(32893),T=a(39347),O=a(93499),q=a(52619),$=a.n(q);function W(e){var t,a;let{location:l,position:s,onClose:r,onNavigate:o,onFavorite:c,className:u}=e,[d,h]=(0,i.useState)(0),[m,g]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=e=>{switch(e.key){case"Escape":r();break;case"ArrowLeft":l.favoritePhotoUrls.length>1&&h(e=>0===e?l.favoritePhotoUrls.length-1:e-1);break;case"ArrowRight":l.favoritePhotoUrls.length>1&&h(e=>e===l.favoritePhotoUrls.length-1?0:e+1);break;case"Enter":g(!m)}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[l.favoritePhotoUrls.length,m,r]);let x=l.favoritePhotoUrls[d]||l.coverPhotoUrl;return(0,n.jsx)(F.P.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.2},className:(0,A.cn)("fixed z-50 bg-white rounded-xl shadow-2xl border border-gray-200","max-w-sm w-full",u),style:{left:Math.min(s.x,window.innerWidth-400),top:Math.min(s.y,window.innerHeight-(m?600:400))},children:(0,n.jsxs)(I.Zp,{className:"border-0 shadow-none",children:[(0,n.jsxs)(I.aR,{className:"pb-3",children:[(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)(I.ZB,{className:"text-lg font-bold text-gray-900 truncate flex items-center gap-2",children:[(0,n.jsx)(w.A,{className:"h-5 w-5 text-blue-600 flex-shrink-0"}),l.name]}),(0,n.jsx)("p",{className:"text-sm text-gray-800 mt-1",children:l.country})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1 ml-2",children:[(0,n.jsx)(S.$,{variant:"ghost",size:"sm",onClick:()=>c(l.id),className:(0,A.cn)("h-8 w-8 p-0",l.isFavorite?"text-red-600":"text-gray-700"),children:(0,n.jsx)(L.A,{className:(0,A.cn)("h-4 w-4",l.isFavorite&&"fill-current")})}),(0,n.jsx)(S.$,{variant:"ghost",size:"sm",onClick:r,className:"h-8 w-8 p-0 text-gray-700 hover:text-gray-800",children:"\xd7"})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-4 mt-3 text-sm text-gray-800",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(y.A,{className:"h-4 w-4"}),new Date(l.visitDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(M.A,{className:"h-4 w-4"}),l.photoCount]})]})]}),(0,n.jsxs)(I.Wu,{className:"pt-0",children:[x&&(0,n.jsx)("div",{className:"relative mb-4 rounded-lg overflow-hidden bg-gray-100",children:(0,n.jsx)("div",{className:"aspect-video bg-cover bg-center bg-gray-200",style:{backgroundImage:"url(".concat(x,")")},children:l.favoritePhotoUrls.length>1&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S.$,{variant:"ghost",size:"sm",onClick:()=>{h(e=>0===e?l.favoritePhotoUrls.length-1:e-1)},className:"absolute left-2 top-1/2 -translate-y-1/2 bg-black/20 text-white hover:bg-black/40 h-8 w-8 p-0 rounded-full",children:(0,n.jsx)(R.A,{className:"h-4 w-4"})}),(0,n.jsx)(S.$,{variant:"ghost",size:"sm",onClick:()=>{h(e=>e===l.favoritePhotoUrls.length-1?0:e+1)},className:"absolute right-2 top-1/2 -translate-y-1/2 bg-black/20 text-white hover:bg-black/40 h-8 w-8 p-0 rounded-full",children:(0,n.jsx)(_.A,{className:"h-4 w-4"})}),(0,n.jsx)("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-1",children:l.favoritePhotoUrls.map((e,t)=>(0,n.jsx)("button",{onClick:()=>h(t),className:(0,A.cn)("w-2 h-2 rounded-full transition-all",t===d?"bg-white":"bg-white/50 hover:bg-white/75")},t))})]})})}),(0,n.jsxs)("div",{className:"space-y-3",children:[l.weather&&(0,n.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-blue-50 rounded-lg",children:[(0,n.jsx)(U.A,{className:"h-4 w-4 text-blue-600"}),(0,n.jsxs)("span",{className:"text-sm",children:[l.weather.temperature,"\xb0C, ",l.weather.condition]})]}),l.tags.length>0&&(0,n.jsxs)("div",{className:"flex flex-wrap gap-1",children:[l.tags.slice(0,m?void 0:3).map(e=>(0,n.jsx)(k.E,{variant:"secondary",className:"text-sm",children:e},e)),!m&&l.tags.length>3&&(0,n.jsxs)(k.E,{variant:"outline",className:"text-sm",children:["+",l.tags.length-3]})]}),m&&l.description&&(0,n.jsx)(F.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"text-sm text-gray-800 leading-relaxed",children:l.description}),l.stats&&(0,n.jsxs)("div",{className:(0,A.cn)("grid grid-cols-3 gap-3 p-3 bg-gray-50 rounded-lg text-center",!m&&"hidden"),children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-lg font-bold text-red-600",children:l.stats.likes}),(0,n.jsx)("div",{className:"text-sm text-gray-800",children:"Likes"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-lg font-bold text-blue-600",children:l.stats.views}),(0,n.jsx)("div",{className:"text-sm text-gray-800",children:"Views"})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"text-lg font-bold text-yellow-600 flex items-center justify-center gap-1",children:[l.stats.rating,(0,n.jsx)(T.A,{className:"h-3 w-3 fill-current"})]}),(0,n.jsx)("div",{className:"text-sm text-gray-800",children:"Rating"})]})]}),m&&(0,n.jsxs)(F.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"flex items-center gap-2 text-sm text-gray-800",children:[(0,n.jsx)(b.A,{className:"h-4 w-4"}),(t=l.latitude,a=l.longitude,"".concat(Math.abs(t).toFixed(2),"\xb0").concat(t>=0?"N":"S",", ").concat(Math.abs(a).toFixed(2),"\xb0").concat(a>=0?"E":"W"))]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 mt-4 pt-3 border-t",children:[(0,n.jsxs)(S.$,{size:"sm",onClick:()=>o(l.latitude,l.longitude),className:"flex-1",children:[(0,n.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Focus"]}),(0,n.jsx)($(),{href:"/albums/".concat(l.id),children:(0,n.jsxs)(S.$,{variant:"outline",size:"sm",children:[(0,n.jsx)(O.A,{className:"h-4 w-4 mr-2"}),"View"]})}),(0,n.jsx)(S.$,{variant:"ghost",size:"sm",onClick:()=>g(!m),className:"px-2",children:m?"Less":"More"})]})]})]})})}function G(e){let{previews:t,onClose:a,onNavigate:i,onFavorite:l}=e;return(0,n.jsx)(z.N,{children:t.map(e=>{let{location:t,position:s}=e;return(0,n.jsx)(W,{location:t,position:s,onClose:()=>a(t.id),onNavigate:i,onFavorite:l},t.id)})})}var V=a(35299),X=a(39068),Y=a(48314),Z=a(53511),J=a(85921),H=a(6191),Q=a(34904),B=a(71629),K=a(54255);let ee=(0,l.default)(()=>Promise.all([a.e(950),a.e(9367),a.e(9804),a.e(594),a.e(3178)]).then(a.bind(a,31096)),{loadableGenerated:{webpack:()=>[31096]},ssr:!1});function et(e){var t;let{className:a}=e,l=(0,i.useRef)(void 0),[u,d]=(0,i.useState)(!1),[h,m]=(0,i.useState)(null),[g,f]=(0,i.useState)(null),[b,y]=(0,i.useState)(!0),[N,M]=(0,i.useState)(!1),[C,P]=(0,i.useState)(!1),[D,F]=(0,i.useState)([]),[z,L]=(0,i.useState)({width:800,height:500}),R=(0,i.useRef)(null),_=(0,i.useRef)(null);(0,i.useEffect)(()=>{let e=()=>{L({width:Math.min(.85*window.innerWidth,1e3),height:window.innerWidth<640?400:window.innerWidth<1024?500:600})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let{availableYears:U,loading:T,error:O,selectedYear:q,setSelectedYear:W,refreshData:et,getYearData:ea}=function(){let{user:e}=(0,r.A)(),[t,a]=(0,i.useState)([]),[n,l]=(0,i.useState)({}),[u,d]=(0,i.useState)(!0),[h,m]=(0,i.useState)(null),[g,x]=(0,i.useState)(null),p=(0,s.UU)(),f=(0,i.useCallback)(async()=>{if(null==e?void 0:e.id)try{let{data:t,error:n}=await p.rpc("get_user_travel_years",{user_id_param:e.id});if(n)throw n;let i=(null==t?void 0:t.map(e=>e.year))||[];a(i.sort((e,t)=>t-e)),i.length>0&&!g&&x(i[0])}catch(e){c.Rm.error("Error fetching available years",{},e),m(e instanceof Error?e.message:"Failed to fetch available years")}},[null==e?void 0:e.id,g,p]),v=(0,i.useCallback)(async t=>{if(!(null==e?void 0:e.id))return null;try{let{data:a,error:n}=await p.rpc("get_user_travel_by_year",{user_id_param:e.id,year_param:t});if(n)throw n;if(!a||0===a.length)return{year:t,locations:[],totalLocations:0,totalPhotos:0,countries:[],totalDistance:0,startDate:null,endDate:null};let i=[],l=new Set,s=0,r=null,c=null;for(let t of a){let a=new Date(t.visit_date);(!r||a<r)&&(r=a),(!c||a>c)&&(c=a),t.country_code&&l.add(t.country_code),s+=t.photo_count||0;let{data:n}=await p.from("albums").select("\n            id,\n            title,\n            cover_photo_url,\n            favorite_photo_urls,\n            user_id,\n            visibility,\n            profiles:user_id (\n              privacy_level\n            ),\n            photos(id, url, caption)\n          ").eq("id",t.album_id),u=(null==n?void 0:n.filter(t=>{if(t.user_id===(null==e?void 0:e.id))return!0;let a=o(t.profiles);return"public"!==a||"public"===t.visibility||"followers"===t.visibility}).map(e=>{var t;return{id:e.id,title:e.title,photoCount:(null==(t=e.photos)?void 0:t.length)||0,coverPhotoUrl:e.cover_photo_url,favoritePhotoUrls:e.favorite_photo_urls,userId:e.user_id,visibility:e.visibility,profilePrivacyLevel:o(e.profiles)}}))||[],d=(null==n?void 0:n.flatMap(e=>{var t;return(null==(t=e.photos)?void 0:t.map(e=>({id:e.id,url:e.url,caption:e.caption})))||[]}))||[],h={id:t.album_id,name:t.location_name||"Location ".concat(t.sequence_order),latitude:parseFloat(t.latitude),longitude:parseFloat(t.longitude),type:t.location_type,visitDate:a,duration:t.duration_days,albums:u,photos:d,airportCode:t.airport_code,timezone:t.timezone,islandGroup:t.island_group};i.push(h)}let u=0;for(let e=0;e<i.length-1;e++){let t=i[e],a=i[e+1],n=b(t,a);u+=n}return{year:t,locations:i,totalLocations:i.length,totalPhotos:s,countries:Array.from(l),totalDistance:u,startDate:r,endDate:c}}catch(e){throw c.Rm.error("Error fetching year data for ".concat(t),{error:e}),e}},[null==e?void 0:e.id,p]),b=(e,t)=>{let a=(t.latitude-e.latitude)*Math.PI/180,n=(t.longitude-e.longitude)*Math.PI/180,i=Math.sin(a/2)*Math.sin(a/2)+Math.cos(e.latitude*Math.PI/180)*Math.cos(t.latitude*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371},y=(0,i.useCallback)(async()=>{if(null==e?void 0:e.id){d(!0),m(null);try{await f(),l({})}catch(e){m(e instanceof Error?e.message:"Failed to refresh data")}finally{d(!1)}}},[f,null==e?void 0:e.id]),w=(0,i.useCallback)(e=>n[e]||null,[n]);return(0,i.useEffect)(()=>{g&&!n[g]&&(d(!0),v(g).then(e=>{e&&l(t=>({...t,[g]:e}))}).catch(e=>{m(e instanceof Error?e.message:"Failed to load year data")}).finally(()=>{d(!1)}))},[g,n,v]),(0,i.useEffect)(()=>{if(!(null==e?void 0:e.id))return;let t=p.channel("albums-changes").on("postgres_changes",{event:"*",schema:"public",table:"albums",filter:"user_id=eq.".concat(e.id)},async e=>{var t,a;c.Rm.info("Album change detected, refreshing globe data",{component:"useTravelTimeline",action:"realtime-album-change",event:e.eventType,albumId:(null==(t=e.new)?void 0:t.id)||(null==(a=e.old)?void 0:a.id)}),await y()}).subscribe(),a=p.channel("photos-changes").on("postgres_changes",{event:"*",schema:"public",table:"photos",filter:"user_id=eq.".concat(e.id)},async e=>{let t=e.new||e.old;t&&(t.latitude||t.longitude)&&(c.Rm.info("Photo with location change detected, refreshing globe data",{component:"useTravelTimeline",action:"realtime-photo-change",event:e.eventType,photoId:t.id}),await y())}).subscribe();return()=>{t.unsubscribe(),a.unsubscribe()}},[null==e?void 0:e.id,y,p]),(0,i.useEffect)(()=>{(null==e?void 0:e.id)&&y()},[null==e?void 0:e.id,y]),{availableYears:t,yearData:n,loading:u,error:h,selectedYear:g,setSelectedYear:x,refreshData:y,getYearData:w}}(),{isPlaying:en,currentFlightState:ei,progress:el,cameraPosition:es,play:er,pause:eo,reset:ec,setLocations:eu}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{autoPlay:t=!1,defaultSpeed:a=1,cameraFollowsPlane:n=!0,onSegmentComplete:l,onAnimationComplete:s,onError:r}=e,[o,c]=(0,i.useState)(!1),[u,d]=(0,i.useState)(!1),[h,m]=(0,i.useState)(!1),[g,f]=(0,i.useState)(null),[v,b]=(0,i.useState)(a),[y,w]=(0,i.useState)([]),[j,N]=(0,i.useState)([]),[M,C]=(0,i.useState)(null),[P,S]=(0,i.useState)(null),[k,I]=(0,i.useState)(n),[A,D]=(0,i.useState)(t),[E,F]=(0,i.useState)({currentSegment:0,totalSegments:0,segmentProgress:0,overallProgress:0,currentLocation:null,nextLocation:null,estimatedTimeRemaining:0}),z=(0,i.useRef)(null),L=(0,i.useRef)(void 0),R=(0,i.useCallback)(()=>{z.current||(z.current=new x(e=>{var t;C({position:{lat:e.position.lat,lng:e.position.lng,altitude:e.position.altitude||0},rotation:e.rotation,speed:e.speed,progress:(null==(t=z.current)?void 0:t.getProgress().percentage)||0})},e=>{k&&S(e)},e=>{let t=y.find(t=>t.id===e.id);t&&(null==l||l(t))}))},[k,y,l]),_=(0,i.useCallback)(async e=>{if(e.length<2)return void N([]);m(!0),f(null);try{let t=[];for(let a=0;a<e.length-1;a++){let n=e[a],i=e[a+1],l=p.generateFlightPath({lat:n.latitude,lng:n.longitude,name:n.name},{lat:i.latitude,lng:i.longitude,name:i.name});t.push(l)}N(t),F(a=>({...a,totalSegments:t.length,currentLocation:e[0]||null,nextLocation:e[1]||null}))}catch(t){let e=t instanceof Error?t.message:"Failed to generate flight paths";f(e),null==r||r(e)}finally{m(!1)}},[r]),U=(0,i.useCallback)(()=>{z.current&&0!==j.length&&(c(!0),d(!1),f(null),z.current.play())},[j.length]),T=(0,i.useCallback)(async e=>{if(w(e),await _(e),R(),z.current&&e.length>0){var t;let a=e.map((e,t)=>({id:e.id,year:e.visitDate.getFullYear(),sequenceOrder:t+1,cityId:void 0,countryId:void 0,visitDate:e.visitDate.toISOString().split("T")[0],latitude:e.latitude,longitude:e.longitude,albumCount:e.albums.length,photoCount:e.photos.length,locationName:e.name}));z.current.setTimeline(a,(null==(t=a[0])?void 0:t.year)||new Date().getFullYear())}A&&e.length>1&&U()},[_,R,A,U]),O=(0,i.useCallback)(()=>{z.current&&(c(!1),d(!0),z.current.pause())},[]),q=(0,i.useCallback)(()=>{z.current&&(c(!1),d(!1),z.current.pause(),z.current.reset(),C(null),S(null),F(e=>({...e,currentSegment:0,segmentProgress:0,overallProgress:0,estimatedTimeRemaining:0})))},[]),$=(0,i.useCallback)(()=>{q(),y.length>0&&F(e=>({...e,currentLocation:y[0]||null,nextLocation:y[1]||null}))},[q,y]),W=(0,i.useCallback)(e=>{let t=Math.max(.1,Math.min(5,e));b(t),z.current&&z.current.setSpeed(t)},[]),G=(0,i.useCallback)(e=>{!z.current||e<0||e>=j.length||(z.current.seekToSegment(e),F(t=>({...t,currentSegment:e,currentLocation:y[e]||null,nextLocation:y[e+1]||null})))},[j.length,y]),V=(0,i.useCallback)(e=>{G(Math.floor(Math.max(0,Math.min(100,e))/100*Math.max(0,j.length-1)))},[j.length,G]),X=(0,i.useCallback)(e=>{D(e)},[]),Y=(0,i.useCallback)(e=>{I(e),e||S(null)},[]),Z=j.reduce((e,t)=>e+t.duration,0);return(0,i.useEffect)(()=>{if(!o||!z.current)return;let e=()=>{if(!z.current)return;let t=z.current.getProgress(),a=y[t.segment]||null,n=y[t.segment+1]||null;F({currentSegment:t.segment,totalSegments:t.total,segmentProgress:t.percentage-t.segment/t.total*100,overallProgress:t.percentage,currentLocation:a,nextLocation:n,estimatedTimeRemaining:Z*(1-t.percentage/100)/v}),t.percentage>=100?(c(!1),d(!1),null==s||s()):L.current=requestAnimationFrame(e)};return L.current=requestAnimationFrame(e),()=>{L.current&&cancelAnimationFrame(L.current)}},[o,y,Z,v,s]),(0,i.useEffect)(()=>()=>{L.current&&cancelAnimationFrame(L.current)},[]),{isPlaying:o,isPaused:u,isLoading:h,error:g,flightPaths:j,currentFlightState:M,progress:E,cameraPosition:P,play:U,pause:O,stop:q,reset:$,setSpeed:W,setLocations:T,seekToSegment:G,seekToProgress:V,speed:v,totalDuration:Z,setAutoPlay:X,setCameraFollow:Y}}({autoPlay:!1,defaultSpeed:1,cameraFollowsPlane:!0,onSegmentComplete:e=>{f(e.id),c.Rm.debug("Flight animation segment completed",{component:"EnhancedGlobe",action:"segment-complete",locationId:e.id,locationName:e.name})},onAnimationComplete:()=>{c.Rm.info("Flight animation completed successfully",{component:"EnhancedGlobe",action:"animation-complete"})},onError:e=>{c.Rm.error("Flight animation failed",{component:"EnhancedGlobe",action:"animation-error"},e)}}),ed=q?ea(q):null,eh=(0,i.useMemo)(()=>(null==ed?void 0:ed.locations)||[],[ed]),em=(0,i.useMemo)(()=>eh.map(e=>{var t;return{id:e.id,name:e.name,latitude:e.latitude,longitude:e.longitude,country:"Unknown Location",visitDate:e.visitDate.toISOString(),albumCount:e.albums.length,photoCount:e.photos.length,coverPhotoUrl:null==(t=e.albums[0])?void 0:t.coverPhotoUrl,tags:[],type:"location"}}),[eh]),eg=function(e){let{cities:t,onCityClick:a,onClusterClick:n,clusterDistance:l=200,activeCity:s}=e,r=(0,i.useMemo)(()=>(function(e,t){if(0===e.length)return[];let a=[],n=new Set;return e.forEach(i=>{if(n.has(i.id))return;let l={id:"cluster-".concat(i.id),latitude:i.latitude,longitude:i.longitude,cities:[i],totalAlbums:i.albumCount,totalPhotos:i.photoCount,radius:Math.max(.8,Math.min(3,.3*Math.sqrt(i.albumCount+i.photoCount)))};n.add(i.id),e.forEach(e=>{if(!n.has(e.id)&&e.id!==i.id&&function(e,t,a,n){let i=e=>e*Math.PI/180,l=i(a-e),s=i(n-t),r=Math.sin(l/2)**2+Math.cos(i(e))*Math.cos(i(a))*Math.sin(s/2)**2;return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371}(i.latitude,i.longitude,e.latitude,e.longitude)<=t){l.cities.push(e),l.totalAlbums+=e.albumCount,l.totalPhotos+=e.photoCount,n.add(e.id);let t=l.cities.reduce((e,t)=>{let a=t.albumCount+t.photoCount+1;return e+t.latitude*a},0)/l.cities.reduce((e,t)=>e+t.albumCount+t.photoCount+1,0),a=l.cities.reduce((e,t)=>{let a=t.albumCount+t.photoCount+1;return e+t.longitude*a},0)/l.cities.reduce((e,t)=>e+t.albumCount+t.photoCount+1,0);l.latitude=t,l.longitude=a,l.radius=Math.max(.8,Math.min(3,.2*Math.sqrt(l.totalAlbums+l.totalPhotos)))}}),a.push(l)}),a})(t,l),[t,l]),o=(0,i.useMemo)(()=>r.map(e=>{let t=e.cities.length>1,a=e.cities.some(e=>e.id===s);return{id:e.id,lat:e.latitude,lng:e.longitude,size:e.radius,color:a?"#ff6b35":t?"#4f46e5":"#06b6d4",cluster:e,isMultiCity:t,isActive:a,label:t?"".concat(e.cities.length," cities"):e.cities[0].name,albumCount:e.totalAlbums,photoCount:e.totalPhotos,opacity:a?1:.8}}),[r,s]),c=(0,i.useMemo)(()=>r.filter(e=>e.totalAlbums>0||e.totalPhotos>0).map(e=>{let t=e.cities.some(e=>e.id===s),a=e.cities.length>1;return{lat:e.latitude,lng:e.longitude+2,text:a?"".concat(e.cities.length," Cities"):e.cities[0].name,size:t?1.2:.8,color:t?"#ff6b35":"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.7)",borderRadius:3,padding:2}}),[r,s]);return{pinData:o,labelData:c,ringData:(0,i.useMemo)(()=>r.filter(e=>e.cities.some(e=>e.id===s)).map(e=>({lat:e.latitude,lng:e.longitude,maxR:2*e.radius,propagationSpeed:4,repeatPeriod:2e3,color:"#ff6b35"})),[r,s]),handlePinClick:e=>{let t=e.cluster;1===t.cities.length?null==a||a(t.cities[0]):null==n||n(t)},clusters:r}}({cities:eh.map(e=>{let t=e.albums[0],a=(null==t?void 0:t.favoritePhotoUrls)||[],n=null==t?void 0:t.coverPhotoUrl,i=a.length>0?a:n?[n]:e.photos.length>0?[e.photos[0].url]:[];return{id:e.id,name:e.name,latitude:e.latitude,longitude:e.longitude,albumCount:e.albums.length,photoCount:e.photos.length,visitDate:e.visitDate.toISOString(),isVisited:!0,isActive:g===e.id,favoritePhotoUrls:i,coverPhotoUrl:n}}),onCityClick:function(e){f(e.id),y(!1);let t=eh.find(t=>t.id===e.id);t&&eb(t,{x:window.innerWidth/2,y:window.innerHeight/2}),l.current&&ex({lat:e.latitude,lng:e.longitude,altitude:1.5},1200,"easeInOutCubic"),setTimeout(()=>y(!0),5e3)},onClusterClick:function(e){m(e),y(!1),l.current&&ex({lat:e.latitude,lng:e.longitude,altitude:1.2},1200,"easeInOutCubic"),setTimeout(()=>y(!0),5e3)},activeCity:g});(0,i.useEffect)(()=>{eh.length>1&&eu(eh)},[eh,eu]),(0,i.useEffect)(()=>{es&&l.current&&ex(es,1500,"easeInOutCubic")},[es]),(0,i.useEffect)(()=>{if(!l.current||!b||N||en){R.current&&clearInterval(R.current);return}return R.current=setInterval(()=>{if(l.current&&!N){let e=l.current.pointOfView();l.current.pointOfView({...e,lng:(e.lng+.3)%360},0)}},50),()=>{R.current&&clearInterval(R.current)}},[b,N,en]);let ex=(0,i.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"easeInOutQuad";if(!l.current)return;_.current&&cancelAnimationFrame(_.current);let n=l.current.pointOfView(),i=Date.now(),s={linear:e=>e,easeInOutQuad:e=>e<.5?2*e*e:-1+(4-2*e)*e,easeInOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2},r=s[a]||s.easeInOutQuad,o=()=>{let a=Math.min((Date.now()-i)/t,1),s=r(a),c={lat:n.lat+(e.lat-n.lat)*s,lng:ep(n.lng,e.lng,s),altitude:n.altitude+(e.altitude-n.altitude)*s};l.current&&l.current.pointOfView(c,0),a<1&&(_.current=requestAnimationFrame(o))};o()},[]),ep=(0,i.useCallback)((e,t,a)=>{let n=t-e;return e+(n>180?n-360:n<-180?n+360:n)*a},[]),ef=(0,i.useCallback)(e=>{if(0===e.length)return{lat:0,lng:0,altitude:2.5};if(1===e.length)return{lat:e[0].latitude,lng:e[0].longitude,altitude:1.8};let t=e.map(e=>e.latitude),a=e.map(e=>e.longitude),n=Math.min(...t),i=Math.max(...t),l=Math.min(...a),s=Math.max(...a),r=Math.max(1.5,Math.min(4,.02*Math.max(i-n,s-l)+1.2));return{lat:(n+i)/2,lng:(l+s)/2,altitude:r}},[]),ev=(0,i.useCallback)(e=>{let t=eh.find(t=>t.id===e.id);t&&(f(e.id),y(!1),ex({lat:e.latitude,lng:e.longitude,altitude:1.5},1500,"easeInOutCubic"),setTimeout(()=>{eb(t,{x:window.innerWidth/2,y:window.innerHeight/2})},800))},[eh,ex]),eb=(0,i.useCallback)((e,t)=>{var a,n;let i={id:e.id,name:e.name,country:"Unknown Location",latitude:e.latitude,longitude:e.longitude,visitDate:e.visitDate.toISOString(),albumCount:e.albums.length,photoCount:e.photos.length,favoritePhotoUrls:(null==(a=e.albums[0])?void 0:a.favoritePhotoUrls)||[],coverPhotoUrl:null==(n=e.albums[0])?void 0:n.coverPhotoUrl,description:"Travel memories from ".concat(e.name),tags:[],isPublic:!0,isFavorite:!1,stats:{likes:0,views:0,shares:0,rating:0}};F(a=>a.find(t=>t.location.id===e.id)?a:[...a,{location:i,position:t}])},[]),ey=(0,i.useCallback)(e=>{F(t=>t.filter(t=>t.location.id!==e))},[]),ew=(0,i.useCallback)(e=>{F(t=>t.map(t=>t.location.id===e?{...t,location:{...t.location,isFavorite:!t.location.isFavorite}}:t)),c.Rm.info("Toggled favorite for location",{component:"EnhancedGlobe",action:"toggle-favorite",locationId:e})},[]),ej=eh[el.currentSegment]?{id:eh[el.currentSegment].id,year:eh[el.currentSegment].visitDate.getFullYear(),sequenceOrder:el.currentSegment+1,cityId:void 0,countryId:void 0,visitDate:eh[el.currentSegment].visitDate.toISOString().split("T")[0],latitude:eh[el.currentSegment].latitude,longitude:eh[el.currentSegment].longitude,albumCount:eh[el.currentSegment].albums.length,photoCount:eh[el.currentSegment].photos.length,locationName:eh[el.currentSegment].name}:null;return T?(0,n.jsx)("div",{className:"space-y-8",children:(0,n.jsxs)("div",{className:"text-center py-12",children:[(0,n.jsx)(V.A,{className:"h-12 w-12 animate-spin mx-auto text-blue-600"}),(0,n.jsx)("h2",{className:"text-xl font-semibold mt-4",children:"Loading your travel timeline..."}),(0,n.jsx)("p",{className:"text-gray-800 mt-2",children:"Preparing flight animation data"})]})}):(0,n.jsxs)("div",{className:"space-y-6 ".concat(a),children:[(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,n.jsx)("div",{children:(0,n.jsxs)("h1",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[(0,n.jsx)(X.A,{className:"h-6 w-6 text-blue-600"}),"Globe"]})}),(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[(0,n.jsxs)(S.$,{variant:"outline",size:"sm",onClick:()=>P(!C),className:(0,A.cn)("text-sm",C?"bg-blue-50 border-blue-300":""),children:[(0,n.jsx)(j.A,{className:"h-4 w-4 sm:mr-2"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Search"})]}),(0,n.jsxs)(S.$,{variant:"outline",size:"sm",onClick:function(){ec(),f(null),m(null),y(!0),l.current&&ex({lat:0,lng:0,altitude:2.5},1500,"easeInOutExpo")},children:[(0,n.jsx)(Y.A,{className:"h-4 w-4 sm:mr-2"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Reset"})]}),(0,n.jsxs)(S.$,{variant:"outline",size:"sm",onClick:function(){en?eo():er()},disabled:eh.length<2,className:"text-sm",children:[en?(0,n.jsx)(Z.A,{className:"h-4 w-4 sm:mr-2"}):(0,n.jsx)(J.A,{className:"h-4 w-4 sm:mr-2"}),(0,n.jsxs)("span",{className:"hidden sm:inline",children:[en?"Pause":"Play"," Flight"]})]}),(0,n.jsx)($(),{href:"/albums/new",children:(0,n.jsxs)(S.$,{size:"sm",className:"text-sm",children:[(0,n.jsx)(H.A,{className:"h-4 w-4 sm:mr-2"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Add Adventure"})]})})]})]}),O&&(0,n.jsx)(I.Zp,{className:"border-red-200 bg-red-50",children:(0,n.jsx)(I.Wu,{className:"pt-6",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-red-600 font-medium",children:"Unable to load travel timeline"}),(0,n.jsx)("p",{className:"text-red-500 text-sm mt-1",children:O}),(0,n.jsx)(S.$,{variant:"outline",onClick:et,className:"mt-4",children:"Try Again"})]})})}),C&&(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)(E,{data:em,onResultClick:ev,onClearSearch:()=>P(!1),className:"w-full max-w-md"})}),U.length>0&&(0,n.jsx)("div",{className:"flex items-center justify-center",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("span",{className:"text-sm font-medium text-gray-800",children:"Travel Year:"}),(0,n.jsx)("div",{className:"flex gap-2",children:U.map(e=>(0,n.jsx)(S.$,{variant:q===e?"default":"outline",size:"sm",onClick:()=>{W(e),f(null),m(null),ec(),setTimeout(()=>{let t=ea(e);t&&t.locations.length>0&&ex(ef(t.locations),2e3,"easeInOutExpo")},500)},className:q===e?"bg-blue-600 hover:bg-blue-700 text-white":"hover:bg-blue-50 hover:border-blue-300",children:e},e))})]})}),(0,n.jsxs)("div",{className:"flex flex-col xl:flex-row gap-6",children:[(0,n.jsx)("div",{className:"flex-1 xl:flex-[2]",children:(0,n.jsxs)("div",{className:"globe-container bg-gradient-to-br from-blue-900 to-purple-900 h-[400px] sm:h-[500px] lg:h-[600px] rounded-lg overflow-hidden relative flex items-center justify-center",children:[(0,n.jsxs)("div",{className:"absolute top-4 right-4 z-10 flex flex-col gap-2",children:[(0,n.jsx)(S.$,{variant:"outline",size:"sm",onClick:function(){if(l.current){let e=l.current.pointOfView(),t=Math.max(.5,.8*e.altitude);ex({...e,altitude:t},400,"easeInOutQuad"),y(!1),setTimeout(()=>y(!0),3e3)}},className:"bg-white/90 hover:bg-white",children:(0,n.jsx)(Q.A,{className:"h-4 w-4"})}),(0,n.jsx)(S.$,{variant:"outline",size:"sm",onClick:function(){if(l.current){let e=l.current.pointOfView(),t=Math.min(5,1.2*e.altitude);ex({...e,altitude:t},400,"easeInOutQuad"),y(!1),setTimeout(()=>y(!0),3e3)}},className:"bg-white/90 hover:bg-white",children:(0,n.jsx)(B.A,{className:"h-4 w-4"})})]}),(0,n.jsx)(ee,{ref:l,globeImageUrl:"//unpkg.com/three-globe/example/img/earth-blue-marble.jpg",backgroundColor:"#0f1729",width:z.width,height:z.height,showAtmosphere:!0,atmosphereColor:"rgba(135, 206, 250, 0.8)",atmosphereAltitude:.25,onGlobeClick:()=>{M(!0),y(!1),setTimeout(()=>{M(!1),y(!0)},3e3)},enablePointerInteraction:!0,htmlElementsData:eg.pinData,htmlLat:e=>e.lat,htmlLng:e=>e.lng,htmlAltitude:e=>.01*e.size,htmlElement:e=>{let t=document.createElement("div");return t.innerHTML='\n                      <div style="\n                        width: '.concat(8*e.size,"px;\n                        height: ").concat(8*e.size,"px;\n                        background: ").concat(e.color,";\n                        border: 2px solid white;\n                        border-radius: 50%;\n                        opacity: ").concat(e.opacity,';\n                        box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n                        cursor: pointer;\n                        transition: all 0.3s ease;\n                        position: relative;\n                      "></div>\n                    '),t.style.pointerEvents="auto",t.addEventListener("click",()=>eg.handlePinClick(e)),t.addEventListener("mouseenter",()=>{t.style.transform="scale(1.2)"}),t.addEventListener("mouseleave",()=>{t.style.transform="scale(1)"}),t.title=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(1===e.cities.length){let a=e.cities[0];if(t)return'\n        <div style="\n          background: rgba(0, 0, 0, 0.95);\n          color: white;\n          padding: 12px;\n          border-radius: 8px;\n          font-family: system-ui;\n          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);\n          max-width: 220px;\n          border: 1px solid rgba(255, 255, 255, 0.1);\n          text-align: center;\n        ">\n          <div style="margin-bottom: 8px;">\n            <div style="\n              width: 40px;\n              height: 40px;\n              background: rgba(255, 255, 255, 0.1);\n              border-radius: 20px;\n              margin: 0 auto 8px;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n            ">\uD83D\uDD12</div>\n          </div>\n          <h3 style="margin: 0 0 6px 0; font-size: 16px; font-weight: 600; color: #ffffff;">'.concat(a.name,'</h3>\n          <p style="font-size: 12px; opacity: 0.8; color: #e5e5e5; margin: 0;">\n            Private content\n          </p>\n          <p style="font-size: 11px; opacity: 0.7; color: #c5c5c5; margin: 4px 0 0 0;">\n            Follow to see adventures\n          </p>\n        </div>\n      ');let n=a.favoritePhotoUrls||[],i=n.length>0?'\n      <div style="\n        display: grid;\n        grid-template-columns: repeat('.concat(Math.min(n.length,3),', 1fr);\n        gap: 4px;\n        margin: 8px 0;\n      ">\n        ').concat(n.slice(0,3).map(e=>'\n          <img src="'.concat(e,'" style="\n            width: 50px;\n            height: 50px;\n            object-fit: cover;\n            border-radius: 4px;\n            border: 1px solid rgba(255, 255, 255, 0.2);\n          " />\n        ')).join(""),"\n      </div>\n    "):"";return'\n      <div style="\n        background: rgba(0, 0, 0, 0.95);\n        color: white;\n        padding: 12px;\n        border-radius: 8px;\n        font-family: system-ui;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);\n        max-width: 220px;\n        border: 1px solid rgba(255, 255, 255, 0.1);\n      ">\n        <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600; color: #ffffff;">'.concat(a.name,"</h3>\n        ").concat(i,'\n        <div style="font-size: 13px; opacity: 0.9; color: #e5e5e5;">\n          <div style="margin-bottom: 3px;">\uD83D\uDCC5 ').concat(new Date(a.visitDate).toLocaleDateString(),'</div>\n          <div style="margin-bottom: 3px;">\uD83D\uDCF8 ').concat(a.albumCount," album").concat(1===a.albumCount?"":"s",'</div>\n          <div style="margin-bottom: 0;">\uD83D\uDDBC️ ').concat(a.photoCount," photo").concat(1===a.photoCount?"":"s","</div>\n        </div>\n      </div>\n    ")}{let t=[];e.cities.forEach(e=>{e.favoritePhotoUrls&&e.favoritePhotoUrls.length>0&&t.push(...e.favoritePhotoUrls.slice(0,1))});let a=t.length>0?'\n      <div style="\n        display: grid;\n        grid-template-columns: repeat('.concat(Math.min(t.length,3),', 1fr);\n        gap: 4px;\n        margin: 8px 0;\n      ">\n        ').concat(t.slice(0,3).map(e=>'\n          <img src="'.concat(e,'" style="\n            width: 50px;\n            height: 50px;\n            object-fit: cover;\n            border-radius: 4px;\n            border: 1px solid rgba(255, 255, 255, 0.2);\n          " />\n        ')).join(""),"\n      </div>\n    "):"";return'\n      <div style="\n        background: rgba(0, 0, 0, 0.95);\n        color: white;\n        padding: 12px;\n        border-radius: 8px;\n        font-family: system-ui;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);\n        max-width: 260px;\n        border: 1px solid rgba(255, 255, 255, 0.1);\n      ">\n        <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600; color: #ffffff;">\n          '.concat(e.cities.length," Cities Cluster\n        </h3>\n        ").concat(a,'\n        <div style="font-size: 13px; opacity: 0.9; color: #e5e5e5;">\n          <div style="margin-bottom: 3px;">\uD83D\uDCF8 ').concat(e.totalAlbums,' total albums</div>\n          <div style="margin-bottom: 6px;">\uD83D\uDDBC️ ').concat(e.totalPhotos,' total photos</div>\n          <div style="font-size: 12px; opacity: 0.7; color: #c5c5c5;">\n            Cities: ').concat(e.cities.map(e=>e.name).slice(0,3).join(", "),"\n            ").concat(e.cities.length>3?" +".concat(e.cities.length-3," more"):"","\n          </div>\n        </div>\n      </div>\n    ")}}(e.cluster),t},labelsData:eg.labelData,labelLat:e=>e.lat,labelLng:e=>e.lng,labelText:e=>e.text,labelSize:e=>e.size,labelColor:e=>e.color,labelDotRadius:.5,labelIncludeDot:!0,ringsData:eg.ringData,ringLat:e=>e.lat,ringLng:e=>e.lng,ringMaxRadius:e=>e.maxR,ringPropagationSpeed:e=>e.propagationSpeed,ringRepeatPeriod:e=>e.repeatPeriod,ringColor:e=>e.color,onGlobeReady:()=>{if(d(!0),eh.length>0){let e=ef(eh);setTimeout(()=>{ex(e,2e3,"easeInOutExpo")},1e3)}}}),(0,n.jsx)(v,{globe:l.current,airplaneState:ei,isActive:en,trailColor:"#00ff88",airplaneScale:.005}),!u&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)(V.A,{className:"h-8 w-8 animate-spin text-blue-600"})})]})}),(0,n.jsx)("div",{className:"w-full xl:w-80",children:(0,n.jsx)(I.Zp,{children:(0,n.jsxs)(I.Wu,{className:"p-6",children:[en&&ej&&(0,n.jsxs)("div",{className:"space-y-4 pb-6 border-b",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(K.A,{className:"h-4 w-4 text-blue-600"}),(0,n.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Current Flight"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium text-gray-900",children:ej.locationName}),(0,n.jsxs)("p",{className:"text-sm text-gray-800",children:["Segment ",el.currentSegment+1," of ",el.totalSegments]})]}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsxs)(k.E,{variant:"outline",className:"text-sm",children:[Math.round(el.overallProgress),"% Complete"]})})]}),h&&(0,n.jsxs)("div",{className:"space-y-4 pb-6 border-b",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(w.A,{className:"h-4 w-4 text-blue-600"}),(0,n.jsx)("span",{className:"text-sm font-medium text-gray-900",children:h.cities.length>1?"".concat(h.cities.length," Cities"):null==(t=h.cities[0])?void 0:t.name})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xl font-bold text-blue-600",children:h.totalAlbums}),(0,n.jsx)("div",{className:"text-xs text-gray-800",children:"Albums"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xl font-bold text-blue-600",children:h.totalPhotos}),(0,n.jsx)("div",{className:"text-xs text-gray-800",children:"Photos"})]})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"text-sm font-medium text-gray-900 mb-3",children:"Quick Actions"}),(0,n.jsx)($(),{href:"/albums/new",children:(0,n.jsxs)(S.$,{className:"w-full justify-start text-sm",children:[(0,n.jsx)(H.A,{className:"mr-2 h-4 w-4"}),"Add New Adventure"]})}),(0,n.jsxs)(S.$,{variant:"outline",size:"sm",className:"w-full justify-start text-sm",onClick:()=>f(null),children:[(0,n.jsx)(w.A,{className:"mr-2 h-4 w-4"}),"Clear Selection"]}),(0,n.jsxs)(S.$,{variant:"outline",size:"sm",className:"w-full justify-start text-sm",onClick:et,children:[(0,n.jsx)(Y.A,{className:"mr-2 h-4 w-4"}),"Refresh Data"]})]})]})})})]}),(0,n.jsx)(G,{previews:D,onClose:ey,onNavigate:(e,t)=>{ex({lat:e,lng:t,altitude:1.5},1e3,"easeInOutCubic")},onFavorite:ew}),C&&(0,n.jsx)("div",{className:"fixed bottom-4 right-4 z-40",children:(0,n.jsx)(I.Zp,{className:"bg-black/80 text-white text-sm p-2",children:(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("kbd",{className:"bg-white/20 px-1 rounded",children:"⌃K"})," Search"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("kbd",{className:"bg-white/20 px-1 rounded",children:"↑↓"})," Navigate"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("kbd",{className:"bg-white/20 px-1 rounded",children:"⏎"})," Select"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("kbd",{className:"bg-white/20 px-1 rounded",children:"Esc"})," Close"]})]})})})]})}function ea(){return(0,n.jsx)("div",{className:"space-y-8",children:(0,n.jsx)(et,{})})}}},e=>{e.O(0,[1831,4545,7559,2619,2738,8415,7550,6869,8441,1255,7358],()=>e(e.s=40265)),_N_E=e.O()}]);