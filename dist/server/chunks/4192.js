"use strict";exports.id=4192,exports.ids=[4192],exports.modules={25220:(a,b,c)=>{c.d(b,{C:()=>p});var d=c(21124),e=c(38301),f=c(35284),g=c(93758),h=c(62186),i=c(88285),j=c(47089),k=c(14263),l=c(8635),m=c(69957),n=c(44943),o=c(57618);function p({value:a,onChange:b,placeholder:c="Search for a location...",className:p,allowCurrentLocation:q=!0}){let[r,s]=(0,e.useState)(""),[t,u]=(0,e.useState)([]),[v,w]=(0,e.useState)(!1),[x,y]=(0,e.useState)(!1),[z,A]=(0,e.useState)(!1),[B,C]=(0,e.useState)(null),[D,E]=(0,e.useState)(0);(0,e.useRef)(null);let F=(0,e.useRef)(null),G=(0,e.useCallback)(async a=>{if(a.trim()){w(!0),C(null);try{let b=await fetch("https://nominatim.openstreetmap.org/search?"+new URLSearchParams({q:a,format:"json",limit:"10",dedupe:"1","accept-language":"en"}));if(!b.ok)throw Error("Failed to search locations");let c=await b.json();u(c),y(!0)}catch(b){o.Rm.error("Location search error",{},b),b instanceof TypeError&&b.message.includes("fetch")&&D<3?(E(a=>a+1),setTimeout(()=>G(a),1e3*(D+1)),C(`Connection failed, retrying... (${D+1}/3)`)):(C("Failed to search locations. Please check your internet connection and try again."),u([]))}finally{w(!1)}}},[D,3]);return(0,d.jsxs)("div",{className:(0,n.cn)("relative",p),children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsxs)("div",{className:"relative flex-1",children:[(0,d.jsx)(i.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-700"}),(0,d.jsx)(g.p,{ref:F,type:"text",value:r,onChange:a=>{let c=a.target.value;s(c),c.trim()||(b(null),y(!1))},placeholder:c,className:"pl-10 pr-10",onFocus:()=>{t.length>0&&y(!0)}}),r&&(0,d.jsx)("button",{type:"button",onClick:()=>{b(null),s(""),y(!1),F.current?.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-100 rounded",children:(0,d.jsx)(j.A,{className:"h-3 w-3 text-gray-700"})}),v&&(0,d.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:(0,d.jsx)(k.A,{className:"h-4 w-4 animate-spin text-gray-700"})})]}),q&&(0,d.jsx)(f.$,{type:"button",variant:"outline",size:"icon",onClick:()=>{if(!navigator.geolocation)return void C("Geolocation is not supported by your browser");A(!0),C(null),navigator.geolocation.getCurrentPosition(async a=>{let{latitude:c,longitude:d}=a.coords;try{let a=await fetch("https://nominatim.openstreetmap.org/reverse?"+new URLSearchParams({lat:c.toString(),lon:d.toString(),format:"json","accept-language":"en"}));if(a.ok){let e=await a.json(),f={latitude:c,longitude:d,display_name:e.display_name||`${c.toFixed(6)}, ${d.toFixed(6)}`,place_id:e.place_id};b(f),s(f.display_name),y(!1)}else{let a={latitude:c,longitude:d,display_name:`${c.toFixed(6)}, ${d.toFixed(6)}`};b(a),s(a.display_name),y(!1)}}catch(e){o.Rm.error("Reverse geocoding error",{},e);let a={latitude:c,longitude:d,display_name:`${c.toFixed(6)}, ${d.toFixed(6)}`};b(a),s(a.display_name),y(!1)}A(!1)},a=>{o.Rm.error("Geolocation error",{errorCode:a.code,errorMessage:a.message});let b="Failed to get your current location";switch(a.code){case a.PERMISSION_DENIED:b="Location access denied. Please enable location permissions.";break;case a.POSITION_UNAVAILABLE:b="Location information unavailable. Please try again.";break;case a.TIMEOUT:b="Location request timed out. Please try again.";break;default:b="Failed to get your current location. Please try again."}C(b),A(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},disabled:z,title:"Use current location",children:z?(0,d.jsx)(k.A,{className:"h-4 w-4 animate-spin"}):(0,d.jsx)(l.A,{className:"h-4 w-4"})})]}),B&&(0,d.jsx)("div",{className:"flex items-start gap-2 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-600",children:(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("p",{children:B}),B.includes("internet connection")&&(0,d.jsx)("button",{onClick:()=>{C(null),E(0),r.length>=3&&G(r)},className:"mt-1 text-red-700 underline hover:no-underline",children:"Try again"})]})}),a&&(0,d.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-800",children:[(0,d.jsx)(m.A,{className:"h-3 w-3"}),(0,d.jsxs)("span",{children:[a.latitude.toFixed(6),", ",a.longitude.toFixed(6)]})]})]}),x&&t.length>0&&(0,d.jsx)(h.Zp,{className:"absolute top-full left-0 right-0 z-50 mt-1 max-h-80 overflow-auto",children:(0,d.jsx)(h.Wu,{className:"p-2",children:t.map(a=>{var c;return(0,d.jsx)("button",{type:"button",className:"w-full text-left p-3 hover:bg-gray-50 rounded-md transition-colors",onClick:()=>{b({latitude:parseFloat(a.lat),longitude:parseFloat(a.lon),display_name:a.display_name,place_id:a.place_id}),s(a.display_name),y(!1),F.current?.blur()},children:(0,d.jsxs)("div",{className:"flex items-start gap-3",children:[(0,d.jsx)(m.A,{className:"h-4 w-4 text-gray-700 mt-0.5 flex-shrink-0"}),(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsx)("p",{className:"font-medium text-gray-900 line-clamp-1",children:(c=a.display_name).length>60?c.substring(0,60)+"...":c}),(0,d.jsxs)("p",{className:"text-sm text-gray-800",children:[parseFloat(a.lat).toFixed(4),", ",parseFloat(a.lon).toFixed(4)]})]})]})},a.place_id)})})}),x&&0===t.length&&r.length>=3&&!v&&(0,d.jsx)(h.Zp,{className:"absolute top-full left-0 right-0 z-50 mt-1",children:(0,d.jsxs)(h.Wu,{className:"p-4 text-center",children:[(0,d.jsxs)("p",{className:"text-gray-800",children:['No locations found for "',r,'"']}),(0,d.jsx)("p",{className:"text-sm text-gray-800 mt-1",children:"Try a different search term"})]})})]})}},30057:(a,b,c)=>{c.d(b,{k:()=>h});var d=c(21124),e=c(38301),f=c(95766),g=c(44943);let h=e.forwardRef(({className:a,value:b,...c},e)=>(0,d.jsx)(f.bL,{ref:e,className:(0,g.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...c,children:(0,d.jsx)(f.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(b||0)}%)`}})}));h.displayName=f.bL.displayName},92797:(a,b,c)=>{c.d(b,{Bb:()=>j,CK:()=>l,F4:()=>n,gN:()=>m});var d=c(20814),e=c(57618);let f=[{id:"photos",name:"photos",public:!0,fileSizeLimit:0x3200000,allowedMimeTypes:["image/jpeg","image/png","image/webp","image/gif"]},{id:"avatars",name:"avatars",public:!0,fileSizeLimit:5242880,allowedMimeTypes:["image/jpeg","image/png","image/webp"]}];class g extends Error{constructor(a,b,c,d){super(a),this.code=b,this.bucket=c,this.filePath=d,this.name="StorageError"}}class h{async simpleUpload(a,b,c){console.log("\uD83D\uDE80 SIMPLE UPLOAD: Starting basic upload (bypassing validation):",{bucketId:a,filePath:b,fileName:c.name,fileSize:c.size,fileType:c.type});try{let{data:d,error:e}=await this.supabase.storage.from(a).upload(b,c);if(console.log("\uD83D\uDE80 SIMPLE UPLOAD: Response:",{data:d,error:e}),e)throw console.error("‚ùå SIMPLE UPLOAD: Failed:",e),new g(`Simple upload failed: ${e.message}`,"SIMPLE_UPLOAD_FAILED",a,b);let{data:f}=this.supabase.storage.from(a).getPublicUrl(b);return console.log("‚úÖ SIMPLE UPLOAD: Success!",{publicUrl:f.publicUrl}),f.publicUrl}catch(a){throw console.error("‚ùå SIMPLE UPLOAD: Exception:",a),a}}async checkBucketExists(a){return console.log("\uD83D\uDD0D Skipping bucket check for:",a,"(assumes bucket exists)"),!0}async validateFile(a,b){console.log("\uD83D\uDD0D File validation details:",{fileName:a.name,fileSize:a.size,fileType:a.type,bucketId:b});let c=f.find(a=>a.id===b);if(!c)throw console.error("‚ùå Unknown bucket:",b),new g(`Unknown bucket: ${b}`,"UNKNOWN_BUCKET",b);if(console.log("‚úÖ Bucket config found:",c),console.log("\uD83D\uDCCF Size check:",{fileSize:a.size,fileSizeMB:(a.size/1024/1024).toFixed(2)+"MB",limit:c.fileSizeLimit,limitMB:Math.round(c.fileSizeLimit/1024/1024)+"MB"}),a.size>c.fileSizeLimit){let d=Math.round(c.fileSizeLimit/1024/1024);throw console.error("‚ùå File too large:",{fileSize:a.size,maxSize:c.fileSizeLimit,maxSizeMB:d}),new g(`File too large. Maximum size is ${d}MB`,"FILE_TOO_LARGE",b)}if(console.log("‚úÖ File size check passed"),console.log("\uD83C\uDFAD MIME type check:",{fileType:a.type,allowedTypes:c.allowedMimeTypes,isAllowed:c.allowedMimeTypes.includes(a.type)}),!c.allowedMimeTypes.includes(a.type))throw console.error("‚ùå Invalid file type:",{fileType:a.type,allowedTypes:c.allowedMimeTypes}),new g(`File type not allowed. Supported types: ${c.allowedMimeTypes.join(", ")}`,"INVALID_FILE_TYPE",b);console.log("‚úÖ MIME type check passed")}async uploadWithRetry(a,b,c,d={}){let{maxRetries:f=3,retryDelay:h=1e3}=d;console.log("\uD83D\uDE80 Starting upload process:",{bucketId:a,filePath:b,fileName:c.name,fileSize:c.size,fileType:c.type,lastModified:c.lastModified}),console.log("\uD83D\uDD0D Starting file validation..."),await this.validateFile(c,a),console.log("‚úÖ File validation passed"),console.log("\uD83E\uDEA3 Checking bucket existence...");let i=await this.checkBucketExists(a);console.log("\uD83E\uDEA3 Bucket check result:",{bucketId:a,exists:i}),i?console.log("‚úÖ Bucket exists, proceeding with upload"):console.warn("‚ö†Ô∏è Bucket check failed, but proceeding anyway (bucket might exist):",a);let j=null;for(let d=1;d<=f;d++)try{e.Rm.info("Attempting file upload",{component:"StorageHelper",action:"uploadWithRetry",bucketId:a,filePath:b,fileName:c.name,fileSize:c.size,attempt:d,maxRetries:f}),console.log(`üì§ Attempt ${d}: Starting Supabase upload...`);let{data:h,error:i}=await this.supabase.storage.from(a).upload(b,c);if(console.log(`üì§ Attempt ${d}: Upload response:`,{uploadData:h,uploadError:i?{message:i.message,name:i.name,cause:i.cause}:null}),i)throw console.error(`‚ùå Upload failed on attempt ${d}:`,i),new g(i.message,"UPLOAD_FAILED",a,b);console.log(`‚úÖ Upload successful on attempt ${d}`);let{data:j}=this.supabase.storage.from(a).getPublicUrl(b);return e.Rm.info("File upload successful",{component:"StorageHelper",action:"uploadWithRetry",bucketId:a,filePath:b,publicUrl:j.publicUrl,attempt:d}),j.publicUrl}catch(c){if(j=c instanceof Error?c:Error(String(c)),e.Rm.warn("Upload attempt failed",{component:"StorageHelper",action:"uploadWithRetry",bucketId:a,filePath:b,attempt:d,maxRetries:f,error:j.message}),c instanceof g&&["FILE_TOO_LARGE","INVALID_FILE_TYPE","BUCKET_NOT_FOUND"].includes(c.code))throw c;d<f&&await new Promise(a=>setTimeout(a,h*d))}console.log("‚ö†Ô∏è Complex upload failed, trying simple upload fallback...");try{let d=await this.simpleUpload(a,b,c);return console.log("‚úÖ FALLBACK SUCCESS: Simple upload worked!"),d}catch(c){throw console.error("‚ùå FALLBACK FAILED: Both complex and simple upload failed"),new g(`Upload failed after ${f} attempts and fallback: ${j?.message||"Unknown error"}. Fallback error: ${c instanceof Error?c.message:String(c)}`,"ALL_UPLOAD_METHODS_FAILED",a,b)}}async deleteFile(a,b){try{let{error:c}=await this.supabase.storage.from(a).remove([b]);if(c)throw new g(c.message,"DELETE_FAILED",a,b);e.Rm.info("File deleted successfully",{component:"StorageHelper",action:"deleteFile",bucketId:a,filePath:b})}catch(c){if(e.Rm.error("File deletion failed",{component:"StorageHelper",action:"deleteFile",bucketId:a,filePath:b},c instanceof Error?c:Error(String(c))),c instanceof g)throw c;throw new g(`Failed to delete file: ${c instanceof Error?c.message:String(c)}`,"DELETE_FAILED",a,b)}}generateUniqueFilePath(a,b){let c=a.split(".").pop(),d=Date.now(),e=Math.random().toString(36).substring(7),f=b?`${b}-`:"";return`${f}${d}-${e}.${c}`}constructor(){this.supabase=(0,d.U)()}}let i=new h,j=a=>{if(a instanceof g)switch(a.code){case"FILE_TOO_LARGE":return"Image is too large. Please compress or choose a smaller image (max 50MB).";case"INVALID_FILE_TYPE":return"File type not supported. Please use JPEG, PNG, WebP, or GIF images.";case"BUCKET_NOT_FOUND":return"Storage system error. Please try again or contact support.";case"SIMPLE_UPLOAD_FAILED":return`Upload failed: ${a.message}`;case"ALL_UPLOAD_METHODS_FAILED":return"Upload failed after multiple attempts. Please check your connection and try again.";default:return a.message||"Upload failed. Please try again."}return a instanceof Error?a.message.includes("413")||a.message.includes("too large")?"Image is too large. Please compress or choose a smaller image.":a.message.includes("network")||a.message.includes("fetch")?"Network error. Please check your connection and try again.":a.message.includes("bucket")||a.message.includes("storage")?"Storage system error. Please try again.":a.message.includes("timeout")?"Upload timed out. Please try again.":a.message:"Unknown error occurred. Please try again."},k=["id","album_id","user_id","file_path","file_size","width","height","caption","taken_at","latitude","longitude","country","city","city_id","island_id","exif_data","processing_status","order_index","created_at"],l=a=>{let b={};for(let[c,d]of Object.entries(a))k.includes(c)?b[c]=d:console.warn(`‚ö†Ô∏è Skipping unknown column '${c}' for photos table`);return b},m=async(a,b)=>{console.log("\uD83D\uDCF8 uploadPhoto called:",{fileName:a.name,fileSize:a.size,fileType:a.type,userId:b});let c=i.generateUniqueFilePath(a.name,b);console.log("\uD83D\uDCF8 Generated file path:",c);try{let b=await i.uploadWithRetry("photos",c,a);return console.log("\uD83D\uDCF8 uploadPhoto success:",b),b}catch(a){throw console.error("\uD83D\uDCF8 uploadPhoto failed:",a),a}},n=async(a,b)=>{let c=`avatars/${i.generateUniqueFilePath(a.name,b)}`;return i.uploadWithRetry("avatars",c,a)}}};