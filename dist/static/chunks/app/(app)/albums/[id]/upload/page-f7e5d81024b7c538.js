(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1354],{6177:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>T});var o=a(95155),r=a(12115),i=a(20063),s=a(43691),l=a(62890),n=a(3998),c=a(76444),d=a(31120),u=a(86948),m=a(80991),p=a(95664),h=a(21786),g=a(61362),f=a(6132),x=a(35626),y=a(23061);let w=(0,a(71847).A)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var v=a(65229),b=a(21873),j=a(16485),N=a(52619),E=a.n(N),P=a(15239),C=a(11636),D=a(50246),L=a(82466),F=a(1243),A=a(72625),S=a(58941);function T(){let e=(0,i.useParams)(),t=(0,i.useRouter)(),{user:N,profile:T,profileLoading:U}=(0,s.A)(),[k,R]=(0,r.useState)([]),[_,I]=(0,r.useState)(!1),[O,M]=(0,r.useState)(null),W=(0,l.UU)(),z=async e=>{console.log("\uD83D\uDCF7 Starting EXIF extraction for:",e.name);try{let t=new Promise((e,t)=>{setTimeout(()=>t(Error("EXIF extraction timeout")),5e3)}),o=await a.e(7573).then(a.bind(a,17573));console.log("\uD83D\uDCF7 EXIF library loaded, parsing file...");let r=await Promise.race([o.parse(e),t]);return console.log("\uD83D\uDCF7 EXIF data extracted:",{fileName:e.name,hasDateTime:!!((null==r?void 0:r.DateTime)||(null==r?void 0:r.DateTimeOriginal)),hasLocation:!!((null==r?void 0:r.latitude)&&(null==r?void 0:r.longitude)),hasCameraInfo:!!(null==r?void 0:r.Make)}),{dateTime:(null==r?void 0:r.DateTime)||(null==r?void 0:r.DateTimeOriginal),latitude:null==r?void 0:r.latitude,longitude:null==r?void 0:r.longitude,cameraMake:null==r?void 0:r.Make,cameraModel:null==r?void 0:r.Model}}catch(t){return console.warn("⚠️ EXIF extraction failed (non-blocking):",{fileName:e.name,error:t instanceof Error?t.message:String(t)}),L.Rm.debug("EXIF extraction failed - photo will be uploaded without metadata",{component:"PhotoUploadPage",action:"extractExifData",fileName:e.name,error:t}),{}}},B=(0,r.useCallback)(async e=>{console.log("\uD83D\uDCC1 Processing dropped files:",e.map(e=>({name:e.name,size:e.size,type:e.type})));let t=[];for(let a of e){console.log("\uD83D\uDCC1 Processing file:",a.name);let e=URL.createObjectURL(a),o={};try{o=await z(a)||{},console.log("✅ EXIF processed for:",a.name)}catch(e){console.warn("⚠️ EXIF processing failed for:",a.name,e),o={}}t.push({file:a,preview:e,caption:"",manualLocation:null,exifData:o,uploadProgress:0,uploadStatus:"pending"})}console.log("\uD83D\uDCC1 All files processed, adding to photos list:",t.length),R(e=>[...e,...t])},[]),{getRootProps:q,getInputProps:G,isDragActive:X}=(0,C.VB)({onDrop:B,accept:{"image/*":[".jpeg",".jpg",".png",".webp",".gif",".heic"]},multiple:!0,onError:e=>{console.error("Dropzone error:",e)},onDropRejected:e=>{console.warn("Files rejected by dropzone:",e.map(e=>({file:e.file.name,errors:e.errors.map(e=>e.message)})))}}),Y=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"camera";try{let t;if(M(null),S.OD.isNative()&&!(await A.w.requestPermissions(["camera"])).camera)return void await A.w.showToast("Camera permission is required to take photos");console.log("\uD83D\uDCF7 Taking photo with native camera...");let a=await A.w.takePhoto({quality:90,allowEditing:!0,resultType:"uri",source:e});if(console.log("\uD83D\uDCF7 Native camera result:",a),S.OD.isNative()&&a.startsWith("file://")||a.startsWith("capacitor://")){let e=await fetch(a),o=await e.blob();t=new File([o],"photo_".concat(Date.now(),".jpg"),{type:"image/jpeg"})}else if(a.startsWith("data:")){let e=await fetch(a),o=await e.blob();t=new File([o],"photo_".concat(Date.now(),".jpg"),{type:"image/jpeg"})}else{let e=await fetch(a),o=await e.blob();t=new File([o],"photo_".concat(Date.now(),".jpg"),{type:"image/jpeg"})}console.log("\uD83D\uDCF7 Created File object:",{name:t.name,size:t.size,type:t.type});let o=URL.createObjectURL(t),r=null;try{if(S.OD.isNative()){let e=await A.w.getCurrentLocation(5e3);r={latitude:e.latitude,longitude:e.longitude,display_name:"".concat(e.latitude.toFixed(6),", ").concat(e.longitude.toFixed(6))},console.log("\uD83D\uDCCD Got location data:",r)}}catch(e){console.warn("\uD83D\uDCCD Could not get location:",e)}let i={};try{i=await z(t)||{},console.log("✅ EXIF processed for camera photo")}catch(e){console.warn("⚠️ EXIF processing failed for camera photo:",e),i={}}let s={file:t,preview:o,caption:"",manualLocation:r,exifData:i,uploadProgress:0,uploadStatus:"pending"};console.log("\uD83D\uDCF7 Adding camera photo to photos list"),R(e=>[...e,s]),await A.w.showToast("Photo captured successfully!")}catch(t){console.error("\uD83D\uDCF7 Native camera error:",t);let e=t instanceof Error?t.message:"Failed to take photo";M(e),await A.w.showToast("Camera error: ".concat(e))}},[z]),$=async(t,a)=>{console.log("\uD83D\uDE80 Starting upload for photo ".concat(a+1,":"),{fileName:t.file.name,fileSize:t.file.size,fileType:t.file.type});try{var o,r,i,s,l,n,c,d,u,m,p;R(e=>{let t=[...e];return t[a].uploadStatus="uploading",t[a].uploadProgress=0,t[a].uploadError=void 0,t});let{data:{user:h},error:g}=await W.auth.getUser();if(g)throw Error("Authentication error: ".concat(g.message));if(!h)throw Error("User not authenticated. Please sign in to upload photos.");console.log("\uD83D\uDCE4 Calling uploadToStorage for photo ".concat(a+1,"..."));let f=await (0,F.gN)(t.file,h.id);console.log("✅ Upload successful for photo ".concat(a+1,":"),f);let x=null!=(u=null!=(d=null==(o=t.manualLocation)?void 0:o.latitude)?d:null==(r=t.exifData)?void 0:r.latitude)?u:null,y=null!=(p=null!=(m=null==(i=t.manualLocation)?void 0:i.longitude)?m:null==(s=t.exifData)?void 0:s.longitude)?p:null,w={...t.exifData,cameraMake:null==(l=t.exifData)?void 0:l.cameraMake,cameraModel:null==(n=t.exifData)?void 0:n.cameraModel,mimeType:t.file.type,orderIndex:a,fileName:t.file.name},v={album_id:e.id,user_id:h.id,file_path:f,caption:t.caption||null,taken_at:(null==(c=t.exifData)?void 0:c.dateTime)||null,latitude:x,longitude:y,file_size:t.file.size,exif_data:w,order_index:a,processing_status:"completed"},b=(0,F.CK)(v);console.log("\uD83D\uDCBE Saving photo ".concat(a+1," to database:"),{albumId:e.id,userId:h.id,filePath:f,filteredPayload:b});let{data:j,error:N}=await W.from("photos").insert(b).select().single();if(N){if("PGRST204"===N.code&&N.message.includes("Could not find the '")){let e=N.message.match(/Could not find the '(.+?)' column/),t=e?e[1]:"unknown";throw Error("Missing DB column: ".concat(t,". Remove it from the insert or add it to the table."))}throw N}return console.log("✅ Database insert successful for photo ".concat(a+1,":"),j),R(e=>{let t=[...e];return t[a].uploadStatus="completed",t[a].uploadProgress=100,t}),!0}catch(r){console.error("❌ Upload failed for photo ".concat(a+1,":"),r),L.Rm.error("Photo upload failed",{component:"PhotoUploadPage",action:"uploadPhoto",albumId:Array.isArray(e.id)?e.id[0]:e.id,fileName:t.file.name,fileSize:t.file.size,userId:null==N?void 0:N.id},r instanceof Error?r:Error(String(r)));let o=(0,F.Bb)(r);return console.log("\uD83D\uDCDD User-friendly error message for photo ".concat(a+1,":"),o),R(e=>{let t=[...e];return t[a].uploadStatus="error",t[a].uploadError=o,t}),!1}},Z=async()=>{if(0===k.length)return;I(!0),M(null);let a=0,o=k.map((e,t)=>$(e,t));a=(await Promise.all(o)).filter(Boolean).length,I(!1),a===k.length?t.push("/albums/".concat(e.id)):M("".concat(a,"/").concat(k.length," photos uploaded successfully. Please retry failed uploads."))};return U?(0,o.jsx)("div",{className:"space-y-8",children:(0,o.jsx)(u.Zp,{children:(0,o.jsx)(u.Wu,{className:"pt-6",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,o.jsx)("p",{className:"mt-2 text-sm text-gray-800",children:"Loading profile..."})]})})})}):N&&!T?(0,o.jsx)("div",{className:"space-y-8",children:(0,o.jsx)(u.Zp,{className:"border-yellow-200 bg-yellow-50",children:(0,o.jsx)(u.Wu,{className:"pt-6",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)(f.A,{className:"h-12 w-12 text-yellow-600 mx-auto mb-4"}),(0,o.jsx)("h3",{className:"text-lg font-semibold text-yellow-900 mb-2",children:"Profile Setup Required"}),(0,o.jsx)("p",{className:"text-yellow-700 mb-4",children:"You need to complete your profile setup before uploading photos."}),(0,o.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,o.jsx)(E(),{href:"/setup",children:(0,o.jsx)(n.$,{children:"Complete Profile Setup"})}),(0,o.jsx)(E(),{href:"/albums/".concat(e.id),children:(0,o.jsx)(n.$,{variant:"outline",children:"Back to Album"})})]})]})})})}):(0,o.jsxs)("div",{className:"space-y-8",children:[(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)(E(),{href:"/albums/".concat(e.id),className:"inline-flex items-center text-sm text-gray-800 hover:text-gray-900",children:[(0,o.jsx)(x.A,{className:"h-4 w-4 mr-1"}),"Back to Album"]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Upload Photos"}),(0,o.jsx)("p",{className:"text-gray-800",children:"Add photos to your adventure album"})]})]}),O&&(0,o.jsx)(u.Zp,{className:"border-red-200 bg-red-50",children:(0,o.jsx)(u.Wu,{className:"pt-6",children:(0,o.jsx)("p",{className:"text-red-600 font-medium",children:O})})}),(0,o.jsxs)(u.Zp,{children:[(0,o.jsxs)(u.aR,{children:[(0,o.jsxs)(u.ZB,{className:"flex items-center gap-2",children:[(0,o.jsx)(h.A,{className:"h-5 w-5"}),"Select Photos"]}),(0,o.jsx)(u.BT,{children:"Drag and drop photos or click to browse. JPEG, PNG, WebP, and HEIC formats supported."})]}),(0,o.jsxs)(u.Wu,{children:[(0,o.jsxs)("div",{...q(),className:"\n              border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors\n              ".concat(X?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400","\n            "),children:[(0,o.jsx)("input",{...G()}),(0,o.jsx)(y.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-700"}),X?(0,o.jsx)("p",{className:"text-lg font-medium text-blue-600",children:"Drop photos here..."}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"Drag photos here or click to browse"}),(0,o.jsx)("p",{className:"text-sm text-gray-800",children:"Upload multiple photos at once. We'll automatically extract location and date information."})]})]}),S.OD.isNative()&&(0,o.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("p",{className:"text-sm text-gray-800 mb-4",children:"Or use your device camera"}),(0,o.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,o.jsxs)(n.$,{type:"button",variant:"outline",onClick:()=>Y("camera"),className:"flex items-center gap-2",disabled:_,children:[(0,o.jsx)(p.A,{className:"h-4 w-4"}),"Take Photo"]}),(0,o.jsxs)(n.$,{type:"button",variant:"outline",onClick:()=>Y("photos"),className:"flex items-center gap-2",disabled:_,children:[(0,o.jsx)(w,{className:"h-4 w-4"}),"Choose from Gallery"]})]})]})})]})]}),k.length>0&&(0,o.jsxs)(u.Zp,{children:[(0,o.jsx)(u.aR,{children:(0,o.jsxs)(u.ZB,{className:"flex items-center justify-between",children:[(0,o.jsxs)("span",{className:"flex items-center gap-2",children:[(0,o.jsx)(w,{className:"h-5 w-5"}),"Photos (",k.length,")"]}),(0,o.jsx)(n.$,{onClick:Z,disabled:_||k.every(e=>"completed"===e.uploadStatus),className:"ml-auto",children:_?"Uploading...":(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"Upload All"]})})]})}),(0,o.jsx)(u.Wu,{children:(0,o.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:k.map((e,t)=>{var a,r,i,s;return(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{className:"relative group",children:[(0,o.jsx)("div",{className:"relative w-full h-48 rounded-lg overflow-hidden",children:(0,o.jsx)(P.default,{src:e.preview,alt:"Upload ".concat(t+1),fill:!0,className:"object-cover"})}),(0,o.jsx)("button",{onClick:()=>{R(e=>{let a=[...e];return URL.revokeObjectURL(a[t].preview),a.splice(t,1),a})},className:"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",disabled:_,children:(0,o.jsx)(v.A,{className:"h-4 w-4"})}),(0,o.jsxs)("div",{className:"absolute bottom-2 left-2 flex items-center gap-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm",children:[(e=>{switch(e){case"pending":return(0,o.jsx)(p.A,{className:"h-4 w-4 text-gray-700"});case"uploading":return(0,o.jsx)(h.A,{className:"h-4 w-4 text-blue-600 animate-pulse"});case"completed":return(0,o.jsx)(g.A,{className:"h-4 w-4 text-green-600"});case"error":return(0,o.jsx)(f.A,{className:"h-4 w-4 text-red-600"})}})(e.uploadStatus),(0,o.jsx)("span",{className:"capitalize",children:e.uploadStatus})]})]}),"uploading"===e.uploadStatus&&(0,o.jsx)(m.k,{value:e.uploadProgress,className:"w-full"}),"error"===e.uploadStatus&&e.uploadError&&(0,o.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded p-3",children:[(0,o.jsx)("p",{className:"text-red-600 text-sm mb-2",children:e.uploadError}),(0,o.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>$(e,t),className:"text-red-600 border-red-300 hover:bg-red-50",children:"Retry Upload"})]}),(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)(c.J,{htmlFor:"caption-".concat(t),children:"Caption"}),(0,o.jsx)(d.T,{id:"caption-".concat(t),value:e.caption,onChange:e=>{var a;return a=e.target.value,void R(e=>{let o=[...e];return o[t].caption=a,o})},placeholder:"Add a caption for this photo...",rows:2,disabled:_})]}),(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)(c.J,{children:"Location"}),(0,o.jsx)(D.C,{value:e.manualLocation,onChange:e=>{R(a=>{let o=[...a];return o[t].manualLocation=e,o})},placeholder:(null==(a=e.exifData)?void 0:a.latitude)&&(null==(r=e.exifData)?void 0:r.longitude)?"Override GPS location or search...":"Search for location...",allowCurrentLocation:!0}),(null==(i=e.exifData)?void 0:i.latitude)&&(null==(s=e.exifData)?void 0:s.longitude)&&!e.manualLocation&&(0,o.jsxs)("p",{className:"text-sm text-gray-800 flex items-center gap-1",children:[(0,o.jsx)(b.A,{className:"h-3 w-3"}),"Using GPS from photo: ",e.exifData.latitude.toFixed(6),", ",e.exifData.longitude.toFixed(6)]})]}),e.exifData&&(0,o.jsxs)("div",{className:"text-sm text-gray-800 space-y-1",children:[e.exifData.dateTime&&(0,o.jsxs)("div",{className:"flex items-center gap-1",children:[(0,o.jsx)(j.A,{className:"h-3 w-3"}),(0,o.jsx)("span",{children:new Date(e.exifData.dateTime).toLocaleDateString()})]}),(e.manualLocation||e.exifData.latitude&&e.exifData.longitude)&&(0,o.jsxs)("div",{className:"flex items-center gap-1",children:[(0,o.jsx)(b.A,{className:"h-3 w-3"}),(0,o.jsx)("span",{children:e.manualLocation?"Manual: ".concat(e.manualLocation.display_name.substring(0,30),"..."):"GPS location detected"})]}),e.exifData.cameraMake&&(0,o.jsxs)("div",{className:"flex items-center gap-1",children:[(0,o.jsx)(p.A,{className:"h-3 w-3"}),(0,o.jsxs)("span",{children:[e.exifData.cameraMake," ",e.exifData.cameraModel]})]})]})]},t)})})})]})]})}},10489:(e,t,a)=>{"use strict";a.d(t,{b:()=>l});var o=a(12115),r=a(97602),i=a(95155),s=o.forwardRef((e,t)=>(0,i.jsx)(r.sG.label,{...e,ref:t,onMouseDown:t=>{var a;t.target.closest("button, input, select, textarea")||(null==(a=e.onMouseDown)||a.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));s.displayName="Label";var l=s},36486:(e,t,a)=>{"use strict";a.d(t,{L:()=>i});var o=a(32587),r=a(87796);let i=(0,o.F3)("Geolocation",{web:()=>a.e(3587).then(a.bind(a,53587)).then(e=>new e.GeolocationWeb)});(0,r.Y)()},47376:(e,t,a)=>{"use strict";a.d(t,{Wi:()=>i.Wi,YA:()=>s,__:()=>i.__});var o=a(32587),r=a(87796),i=a(55102);let s=(0,o.F3)("Filesystem",{web:()=>a.e(2282).then(a.bind(a,32282)).then(e=>new e.FilesystemWeb)});(0,r.Y)()},50246:(e,t,a)=>{"use strict";a.d(t,{C:()=>g});var o=a(95155),r=a(12115),i=a(3998),s=a(65142),l=a(86948),n=a(86651),c=a(65229),d=a(35299),u=a(76561),m=a(21873),p=a(64269),h=a(82466);function g(e){let{value:t,onChange:a,placeholder:g="Search for a location...",className:f,allowCurrentLocation:x=!0}=e,[y,w]=(0,r.useState)(""),[v,b]=(0,r.useState)([]),[j,N]=(0,r.useState)(!1),[E,P]=(0,r.useState)(!1),[C,D]=(0,r.useState)(!1),[L,F]=(0,r.useState)(null),[A,S]=(0,r.useState)(0),T=(0,r.useRef)(null),U=(0,r.useRef)(null);(0,r.useEffect)(()=>{(null==t?void 0:t.display_name)?w(t.display_name):w("")},[t]);let k=(0,r.useCallback)(async e=>{if(e.trim()){N(!0),F(null);try{let t=await fetch("https://nominatim.openstreetmap.org/search?"+new URLSearchParams({q:e,format:"json",limit:"10",dedupe:"1","accept-language":"en"}));if(!t.ok)throw Error("Failed to search locations");let a=await t.json();b(a),P(!0)}catch(t){h.Rm.error("Location search error",{},t),t instanceof TypeError&&t.message.includes("fetch")&&A<3?(S(e=>e+1),setTimeout(()=>k(e),1e3*(A+1)),F("Connection failed, retrying... (".concat(A+1,"/").concat(3,")"))):(F("Failed to search locations. Please check your internet connection and try again."),b([]))}finally{N(!1)}}},[A,3]);return(0,r.useEffect)(()=>(T.current&&clearTimeout(T.current),y.length>=3?T.current=setTimeout(()=>{k(y)},500):(b([]),P(!1)),()=>{T.current&&clearTimeout(T.current)}),[y,k]),(0,o.jsxs)("div",{className:(0,p.cn)("relative",f),children:[(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsxs)("div",{className:"flex gap-2",children:[(0,o.jsxs)("div",{className:"relative flex-1",children:[(0,o.jsx)(n.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-700"}),(0,o.jsx)(s.p,{ref:U,type:"text",value:y,onChange:e=>{let t=e.target.value;w(t),t.trim()||(a(null),P(!1))},placeholder:g,className:"pl-10 pr-10",onFocus:()=>{v.length>0&&P(!0)}}),y&&(0,o.jsx)("button",{type:"button",onClick:()=>{var e;a(null),w(""),P(!1),null==(e=U.current)||e.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-100 rounded",children:(0,o.jsx)(c.A,{className:"h-3 w-3 text-gray-700"})}),j&&(0,o.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:(0,o.jsx)(d.A,{className:"h-4 w-4 animate-spin text-gray-700"})})]}),x&&(0,o.jsx)(i.$,{type:"button",variant:"outline",size:"icon",onClick:()=>{if(!navigator.geolocation)return void F("Geolocation is not supported by your browser");D(!0),F(null),navigator.geolocation.getCurrentPosition(async e=>{let{latitude:t,longitude:o}=e.coords;try{let e=await fetch("https://nominatim.openstreetmap.org/reverse?"+new URLSearchParams({lat:t.toString(),lon:o.toString(),format:"json","accept-language":"en"}));if(e.ok){let r=await e.json(),i={latitude:t,longitude:o,display_name:r.display_name||"".concat(t.toFixed(6),", ").concat(o.toFixed(6)),place_id:r.place_id};a(i),w(i.display_name),P(!1)}else{let e={latitude:t,longitude:o,display_name:"".concat(t.toFixed(6),", ").concat(o.toFixed(6))};a(e),w(e.display_name),P(!1)}}catch(r){h.Rm.error("Reverse geocoding error",{},r);let e={latitude:t,longitude:o,display_name:"".concat(t.toFixed(6),", ").concat(o.toFixed(6))};a(e),w(e.display_name),P(!1)}D(!1)},e=>{h.Rm.error("Geolocation error",{errorCode:e.code,errorMessage:e.message});let t="Failed to get your current location";switch(e.code){case e.PERMISSION_DENIED:t="Location access denied. Please enable location permissions.";break;case e.POSITION_UNAVAILABLE:t="Location information unavailable. Please try again.";break;case e.TIMEOUT:t="Location request timed out. Please try again.";break;default:t="Failed to get your current location. Please try again."}F(t),D(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},disabled:C,title:"Use current location",children:C?(0,o.jsx)(d.A,{className:"h-4 w-4 animate-spin"}):(0,o.jsx)(u.A,{className:"h-4 w-4"})})]}),L&&(0,o.jsx)("div",{className:"flex items-start gap-2 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-600",children:(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)("p",{children:L}),L.includes("internet connection")&&(0,o.jsx)("button",{onClick:()=>{F(null),S(0),y.length>=3&&k(y)},className:"mt-1 text-red-700 underline hover:no-underline",children:"Try again"})]})}),t&&(0,o.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-800",children:[(0,o.jsx)(m.A,{className:"h-3 w-3"}),(0,o.jsxs)("span",{children:[t.latitude.toFixed(6),", ",t.longitude.toFixed(6)]})]})]}),E&&v.length>0&&(0,o.jsx)(l.Zp,{className:"absolute top-full left-0 right-0 z-50 mt-1 max-h-80 overflow-auto",children:(0,o.jsx)(l.Wu,{className:"p-2",children:v.map(e=>{var t;return(0,o.jsx)("button",{type:"button",className:"w-full text-left p-3 hover:bg-gray-50 rounded-md transition-colors",onClick:()=>{var t;a({latitude:parseFloat(e.lat),longitude:parseFloat(e.lon),display_name:e.display_name,place_id:e.place_id}),w(e.display_name),P(!1),null==(t=U.current)||t.blur()},children:(0,o.jsxs)("div",{className:"flex items-start gap-3",children:[(0,o.jsx)(m.A,{className:"h-4 w-4 text-gray-700 mt-0.5 flex-shrink-0"}),(0,o.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,o.jsx)("p",{className:"font-medium text-gray-900 line-clamp-1",children:(t=e.display_name).length>60?t.substring(0,60)+"...":t}),(0,o.jsxs)("p",{className:"text-sm text-gray-800",children:[parseFloat(e.lat).toFixed(4),", ",parseFloat(e.lon).toFixed(4)]})]})]})},e.place_id)})})}),E&&0===v.length&&y.length>=3&&!j&&(0,o.jsx)(l.Zp,{className:"absolute top-full left-0 right-0 z-50 mt-1",children:(0,o.jsxs)(l.Wu,{className:"p-4 text-center",children:[(0,o.jsxs)("p",{className:"text-gray-800",children:['No locations found for "',y,'"']}),(0,o.jsx)("p",{className:"text-sm text-gray-800 mt-1",children:"Try a different search term"})]})})]})}},55102:(e,t,a)=>{"use strict";var o,r;a.d(t,{Wi:()=>r,__:()=>o}),function(e){e.Documents="DOCUMENTS",e.Data="DATA",e.Library="LIBRARY",e.Cache="CACHE",e.External="EXTERNAL",e.ExternalStorage="EXTERNAL_STORAGE",e.ExternalCache="EXTERNAL_CACHE",e.LibraryNoCloud="LIBRARY_NO_CLOUD",e.Temporary="TEMPORARY"}(o||(o={})),function(e){e.UTF8="utf8",e.ASCII="ascii",e.UTF16="utf16"}(r||(r={}))},58941:(e,t,a)=>{"use strict";a.d(t,{OD:()=>r});var o=a(32587);class r{static getInfo(){if(!this.info){let e=o.Ii.getPlatform();this.info={isWeb:"web"===e,isNative:"web"!==e,isAndroid:"android"===e,isIOS:"ios"===e,platform:e}}return this.info}static isWeb(){return this.getInfo().isWeb}static isNative(){return this.getInfo().isNative}static isAndroid(){return this.getInfo().isAndroid}static isIOS(){return this.getInfo().isIOS}static getPlatform(){return this.getInfo().platform}static isCapabilityAvailable(e){let{isNative:t,isWeb:a}=this.getInfo();switch(e){case"camera":return t||a&&"MediaDevices"in window&&"getUserMedia"in navigator.mediaDevices;case"geolocation":return t||a&&"geolocation"in navigator;case"filesystem":return t||a&&"File"in window;case"share":return t||a&&"share"in navigator;case"toast":return!0;default:return!1}}static getUserAgent(){return"undefined"!=typeof navigator?navigator.userAgent:""}static isDevelopment(){return!1}static isStandalone(){let{isNative:e}=this.getInfo();return!!e||window.matchMedia("(display-mode: standalone)").matches||"standalone"in navigator&&!0===navigator.standalone}static getDeviceInfo(){var e;let t=this.getInfo(),a=this.getUserAgent();return{...t,userAgent:a,isStandalone:this.isStandalone(),isDevelopment:this.isDevelopment(),hasTouch:"ontouchstart"in window,screen:{width:window.screen.width,height:window.screen.height,orientation:null==(e=window.screen.orientation)?void 0:e.type}}}}r.info=null},67910:(e,t,a)=>{Promise.resolve().then(a.bind(a,6177))},68974:(e,t,a)=>{"use strict";a.d(t,{S:()=>o});let o=(0,a(32587).F3)("Share",{web:()=>a.e(2532).then(a.bind(a,32532)).then(e=>new e.ShareWeb)})},71223:(e,t,a)=>{"use strict";a.d(t,{i7:()=>n,LK:()=>i,ru:()=>o});var o,r,i,s=a(32587);!function(e){e.Prompt="PROMPT",e.Camera="CAMERA",e.Photos="PHOTOS"}(o||(o={})),function(e){e.Rear="REAR",e.Front="FRONT"}(r||(r={})),function(e){e.Uri="uri",e.Base64="base64",e.DataUrl="dataUrl"}(i||(i={}));class l extends s.E_{async getPhoto(e){return new Promise(async(t,a)=>{if(e.webUseInput||e.source===o.Photos)this.fileInputExperience(e,t,a);else if(e.source===o.Prompt){let o=document.querySelector("pwa-action-sheet");o||(o=document.createElement("pwa-action-sheet"),document.body.appendChild(o)),o.header=e.promptLabelHeader||"Photo",o.cancelable=!1,o.options=[{title:e.promptLabelPhoto||"From Photos"},{title:e.promptLabelPicture||"Take Picture"}],o.addEventListener("onSelection",async o=>{0===o.detail?this.fileInputExperience(e,t,a):this.cameraExperience(e,t,a)})}else this.cameraExperience(e,t,a)})}async pickImages(e){return new Promise(async(e,t)=>{this.multipleFileInputExperience(e,t)})}async cameraExperience(e,t,a){if(customElements.get("pwa-camera-modal")){let o=document.createElement("pwa-camera-modal");o.facingMode=e.direction===r.Front?"user":"environment",document.body.appendChild(o);try{await o.componentOnReady(),o.addEventListener("onPhoto",async r=>{let i=r.detail;null===i?a(new s.I9("User cancelled photos app")):i instanceof Error?a(i):t(await this._getCameraPhoto(i,e)),o.dismiss(),document.body.removeChild(o)}),o.present()}catch(o){this.fileInputExperience(e,t,a)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(e,t,a)}fileInputExperience(e,t,a){let i=document.querySelector("#_capacitor-camera-input"),l=()=>{var e;null==(e=i.parentNode)||e.removeChild(i)};i||((i=document.createElement("input")).id="_capacitor-camera-input",i.type="file",i.hidden=!0,document.body.appendChild(i),i.addEventListener("change",a=>{let o=i.files[0],r="jpeg";if("image/png"===o.type?r="png":"image/gif"===o.type&&(r="gif"),"dataUrl"===e.resultType||"base64"===e.resultType){let a=new FileReader;a.addEventListener("load",()=>{"dataUrl"===e.resultType?t({dataUrl:a.result,format:r}):"base64"===e.resultType&&t({base64String:a.result.split(",")[1],format:r}),l()}),a.readAsDataURL(o)}else t({webPath:URL.createObjectURL(o),format:r}),l()}),i.addEventListener("cancel",e=>{a(new s.I9("User cancelled photos app")),l()})),i.accept="image/*",i.capture=!0,e.source===o.Photos||e.source===o.Prompt?i.removeAttribute("capture"):e.direction===r.Front?i.capture="user":e.direction===r.Rear&&(i.capture="environment"),i.click()}multipleFileInputExperience(e,t){let a=document.querySelector("#_capacitor-camera-input-multiple"),o=()=>{var e;null==(e=a.parentNode)||e.removeChild(a)};a||((a=document.createElement("input")).id="_capacitor-camera-input-multiple",a.type="file",a.hidden=!0,a.multiple=!0,document.body.appendChild(a),a.addEventListener("change",t=>{let r=[];for(let e=0;e<a.files.length;e++){let t=a.files[e],o="jpeg";"image/png"===t.type?o="png":"image/gif"===t.type&&(o="gif"),r.push({webPath:URL.createObjectURL(t),format:o})}e({photos:r}),o()}),a.addEventListener("cancel",e=>{t(new s.I9("User cancelled photos app")),o()})),a.accept="image/*",a.click()}_getCameraPhoto(e,t){return new Promise((a,o)=>{let r=new FileReader,i=e.type.split("/")[1];"uri"===t.resultType?a({webPath:URL.createObjectURL(e),format:i,saved:!1}):(r.readAsDataURL(e),r.onloadend=()=>{let e=r.result;"dataUrl"===t.resultType?a({dataUrl:e,format:i,saved:!1}):a({base64String:e.split(",")[1],format:i,saved:!1})},r.onerror=e=>{o(e)})})}async checkPermissions(){if("undefined"==typeof navigator||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch(e){throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}new l;let n=(0,s.F3)("Camera",{web:()=>new l})},72625:(e,t,a)=>{"use strict";a.d(t,{w:()=>c});var o=a(71223),r=a(36486),i=a(47376),s=a(68974),l=a(93902),n=a(58941);class c{static async takePhoto(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{quality:t=90,allowEditing:a=!1,resultType:r="uri",source:i="prompt"}=e;if(!n.OD.isNative())return new Promise((e,t)=>{let a=document.createElement("input");a.type="file",a.accept="image/*","camera"===i&&(a.capture="environment"),a.onchange=a=>{var o;let i=null==(o=a.target.files)?void 0:o[0];if(i)if("base64"===r){let a=new FileReader;a.onload=()=>e(a.result),a.onerror=()=>t(Error("Failed to read file")),a.readAsDataURL(i)}else e(URL.createObjectURL(i));else t(Error("No file selected"))},a.click()});try{let e=await o.i7.getPhoto({quality:t,allowEditing:a,resultType:"base64"===r?o.LK.Base64:o.LK.Uri,source:"camera"===i?o.ru.Camera:"photos"===i?o.ru.Photos:o.ru.Prompt});if("base64"===r)return"data:image/jpeg;base64,".concat(e.base64String);return e.webPath||e.path||""}catch(e){throw console.error("Native camera error:",e),Error("Failed to take photo: ".concat(e instanceof Error?e.message:"Unknown error"))}}static async getCurrentLocation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;if(!n.OD.isNative())return new Promise((t,a)=>{if(!("geolocation"in navigator))return void a(Error("Geolocation not supported"));let o=setTimeout(()=>{a(Error("Location request timeout"))},e);navigator.geolocation.getCurrentPosition(e=>{clearTimeout(o),t({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,altitude:e.coords.altitude||void 0,speed:e.coords.speed||void 0,heading:e.coords.heading||void 0})},e=>{clearTimeout(o),a(Error("Geolocation error: ".concat(e.message)))},{enableHighAccuracy:!0,timeout:e,maximumAge:3e5})});try{let t=await r.L.getCurrentPosition({timeout:e,enableHighAccuracy:!0});return{latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,altitude:t.coords.altitude||void 0,speed:t.coords.speed||void 0,heading:t.coords.heading||void 0}}catch(e){throw console.error("Native geolocation error:",e),Error("Failed to get location")}}static async share(e){let{title:t,text:a,url:o,files:r}=e;if(n.OD.isNative())try{let e={title:t,text:a,url:o};r&&r.length>0?await s.S.share({...e,files:r}):await s.S.share(e)}catch(e){throw console.error("Native share error:",e),Error("Failed to share content")}else if("share"in navigator&&navigator.share)try{await navigator.share({title:t,text:a,url:o,files:null==r?void 0:r.map(e=>new File([],e))})}catch(e){throw Error("Failed to share content")}else{let e=[t,a,o].filter(Boolean).join(" - ");if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(e),await c.showToast("Copied to clipboard");else{let t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),await c.showToast("Copied to clipboard")}}}static async showToast(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"short";if(n.OD.isNative())try{await l.y.show({text:e,duration:"short"===t?"short":"long"})}catch(t){console.error("Native toast error:",t),alert(e)}else{console.info("Toast:",e);let a=document.createElement("div");a.textContent=e,a.style.cssText="\n        position: fixed;\n        bottom: 20px;\n        left: 50%;\n        transform: translateX(-50%);\n        background: rgba(0, 0, 0, 0.8);\n        color: white;\n        padding: 12px 24px;\n        border-radius: 24px;\n        z-index: 10000;\n        font-family: -apple-system, BlinkMacSystemFont, sans-serif;\n        font-size: 14px;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        transition: opacity 0.3s ease;\n      ",document.body.appendChild(a),setTimeout(()=>{a.style.opacity="0",setTimeout(()=>{a.parentNode&&document.body.removeChild(a)},300)},"short"===t?2e3:3500)}}static async saveFile(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{directory:o=i.__.Documents,encoding:r=i.Wi.UTF8}=a;if(n.OD.isNative())try{return(await i.YA.writeFile({path:e,data:t,directory:o,encoding:r})).uri}catch(e){throw console.error("Native filesystem error:",e),Error("Failed to save file")}{let a=new Blob([t],{type:"text/plain"}),o=URL.createObjectURL(a),r=document.createElement("a");return r.href=o,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o),e}}static async readFile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{directory:a=i.__.Documents,encoding:o=i.Wi.UTF8}=t;if(n.OD.isNative())try{return(await i.YA.readFile({path:e,directory:a,encoding:o})).data}catch(e){throw console.error("Native filesystem read error:",e),Error("Failed to read file")}throw Error("File reading not supported on web platform")}static async requestPermissions(e){let t={};if(n.OD.isNative())for(let a of e)try{if("camera"===a){let e=await o.i7.requestPermissions();t.camera="granted"===e.camera||"granted"===e.photos}else if("geolocation"===a){let e=await r.L.requestPermissions();t.geolocation="granted"===e.location}}catch(e){console.error("Permission request failed for ".concat(a,":"),e),t[a]=!1}else for(let a of e)t[a]=n.OD.isCapabilityAvailable(a);return t}}},80991:(e,t,a)=>{"use strict";a.d(t,{k:()=>l});var o=a(95155),r=a(12115),i=a(9484),s=a(64269);let l=r.forwardRef((e,t)=>{let{className:a,value:r,...l}=e;return(0,o.jsx)(i.bL,{ref:t,className:(0,s.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...l,children:(0,o.jsx)(i.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});l.displayName=i.bL.displayName},87796:(e,t,a)=>{"use strict";function o(e=!1){var t,a;typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},void 0===window.Capacitor||e?void 0!==window.cordova&&((t=window).CapacitorUtils.Synapse=new Proxy({},{get:(e,a)=>t.cordova.plugins[a]})):(a=window).CapacitorUtils.Synapse=new Proxy({},{get:(e,t)=>new Proxy({},{get:(e,o)=>(e,r,i)=>{let s=a.Capacitor.Plugins[t];return void 0===s?void i(Error(`Capacitor plugin ${t} not found`)):"function"!=typeof s[o]?void i(Error(`Method ${o} not found in Capacitor plugin ${t}`)):void(async()=>{try{let t=await s[o](e);r(t)}catch(e){i(e)}})()}})}))}a.d(t,{Y:()=>o})},93902:(e,t,a)=>{"use strict";a.d(t,{y:()=>o});let o=(0,a(32587).F3)("Toast",{web:()=>a.e(2484).then(a.bind(a,42484)).then(e=>new e.ToastWeb)})}},e=>{e.O(0,[4545,7559,2619,2738,6769,2313,6869,3147,8441,1255,7358],()=>e(e.s=67910)),_N_E=e.O()}]);