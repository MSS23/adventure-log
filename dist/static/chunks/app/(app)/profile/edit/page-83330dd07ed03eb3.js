(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2882],{3468:(e,s,r)=>{"use strict";r.d(s,{A:()=>n,q:()=>l});var a=r(12115),t=r(95155);function l(e,s){let r=a.createContext(s),l=e=>{let{children:s,...l}=e,n=a.useMemo(()=>l,Object.values(l));return(0,t.jsx)(r.Provider,{value:n,children:s})};return l.displayName=e+"Provider",[l,function(t){let l=a.useContext(r);if(l)return l;if(void 0!==s)return s;throw Error(`\`${t}\` must be used within \`${e}\``)}]}function n(e,s=[]){let r=[],l=()=>{let s=r.map(e=>a.createContext(e));return function(r){let t=r?.[e]||s;return a.useMemo(()=>({[`__scope${e}`]:{...r,[e]:t}}),[r,t])}};return l.scopeName=e,[function(s,l){let n=a.createContext(l),i=r.length;r=[...r,l];let o=s=>{let{scope:r,children:l,...o}=s,c=r?.[e]?.[i]||n,d=a.useMemo(()=>o,Object.values(o));return(0,t.jsx)(c.Provider,{value:d,children:l})};return o.displayName=s+"Provider",[o,function(r,t){let o=t?.[e]?.[i]||n,c=a.useContext(o);if(c)return c;if(void 0!==l)return l;throw Error(`\`${r}\` must be used within \`${s}\``)}]},function(...e){let s=e[0];if(1===e.length)return s;let r=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let t=r.reduce((s,{useScope:r,scopeName:a})=>{let t=r(e)[`__scope${a}`];return{...s,...t}},{});return a.useMemo(()=>({[`__scope${s.scopeName}`]:t}),[t])}};return r.scopeName=s.scopeName,r}(l,...s)]}},4129:(e,s,r)=>{"use strict";r.d(s,{N:()=>t});var a=r(12115),t=globalThis?.document?a.useLayoutEffect:()=>{}},4839:(e,s,r)=>{Promise.resolve().then(r.bind(r,7505))},7505:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>S});var a=r(95155),t=r(12115),l=r(20063),n=r(22544),i=r(66942),o=r(43691),c=r(62890),d=r(3998),u=r(65142),m=r(76444),p=r(31120),f=r(86948),h=r(85897),x=r(35626),v=r(20508),j=r(21786),y=r(46046),N=r(52619),b=r.n(N),g=r(72911),w=r(82466),P=r(1243);function S(){let e=(0,l.useRouter)(),{user:s,profile:r,refreshProfile:N}=(0,o.A)(),[S,E]=(0,t.useState)(!1),[_,A]=(0,t.useState)(null),[k,C]=(0,t.useState)(null),[L,R]=(0,t.useState)(null),$=(0,c.UU)(),{register:Y,handleSubmit:F,formState:{errors:U},setValue:I,watch:O}=(0,n.mN)({resolver:(0,i.u)(g.Fk)});(0,t.useEffect)(()=>{r&&(I("username",r.username),I("display_name",r.display_name||""),I("bio",r.bio||""),I("website",r.website||""),I("location",r.location||""),R(r.avatar_url||null))},[r,I]);let B=async e=>{try{return await (0,P.F4)(e,s.id)}catch(e){return w.Rm.error("Avatar upload operation failed",{component:"ProfileEditPage",action:"uploadAvatar",userId:null==s?void 0:s.id},e instanceof Error?e:Error(String(e))),null}},Z=async a=>{try{E(!0),A(null);let t=null==r?void 0:r.avatar_url;if(k){let e=await B(k);if(e)t=e;else throw Error("Failed to upload avatar")}let{error:l}=await $.from("profiles").update({username:a.username,display_name:a.display_name||null,bio:a.bio||null,website:a.website||null,location:a.location||null,avatar_url:t,updated_at:new Date().toISOString()}).eq("id",null==s?void 0:s.id);if(l)throw l;await N(),e.push("/profile")}catch(e){w.Rm.error("Profile update failed",{component:"ProfileEditPage",action:"updateProfile",userId:null==s?void 0:s.id},e instanceof Error?e:Error(String(e))),A(e instanceof Error?e.message:"Failed to update profile")}finally{E(!1)}};return r?(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(b(),{href:"/profile",className:"inline-flex items-center text-sm text-gray-800 hover:text-gray-900",children:[(0,a.jsx)(x.A,{className:"h-4 w-4 mr-1"}),"Back to Profile"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Edit Profile"}),(0,a.jsx)("p",{className:"text-gray-800",children:"Update your personal information and preferences"})]})]}),(0,a.jsxs)("form",{onSubmit:F(Z),className:"space-y-8",children:[_&&(0,a.jsx)(f.Zp,{className:"border-red-200 bg-red-50",children:(0,a.jsx)(f.Wu,{className:"pt-6",children:(0,a.jsx)("p",{className:"text-red-600 font-medium",children:_})})}),(0,a.jsxs)(f.Zp,{children:[(0,a.jsxs)(f.aR,{children:[(0,a.jsxs)(f.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(v.A,{className:"h-5 w-5"}),"Profile Picture"]}),(0,a.jsx)(f.BT,{children:"Upload a profile picture to help others recognize you"})]}),(0,a.jsx)(f.Wu,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsxs)(h.eu,{className:"h-24 w-24",children:[(0,a.jsx)(h.BK,{src:L||"",alt:"Profile picture"}),(0,a.jsx)(h.q5,{className:"text-xl",children:(O("display_name")||O("username")||"User").split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"avatar",className:"cursor-pointer",children:(0,a.jsx)(d.$,{type:"button",variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)("span",{children:[(0,a.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Choose Image"]})})}),(0,a.jsx)(u.p,{id:"avatar",type:"file",accept:"image/*",onChange:e=>{var s;let r=null==(s=e.target.files)?void 0:s[0];r&&(C(r),R(URL.createObjectURL(r)))},className:"hidden"}),(0,a.jsx)("p",{className:"text-sm text-gray-800",children:"Recommended: Square image, at least 200x200px"})]})]})})]}),(0,a.jsxs)(f.Zp,{children:[(0,a.jsxs)(f.aR,{children:[(0,a.jsx)(f.ZB,{children:"Basic Information"}),(0,a.jsx)(f.BT,{children:"Your public profile information"})]}),(0,a.jsxs)(f.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"username",children:"Username *"}),(0,a.jsx)(u.p,{id:"username",...Y("username"),className:U.username?"border-red-500":""}),U.username&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:U.username.message}),(0,a.jsx)("p",{className:"text-sm text-gray-800",children:"Your unique identifier on Adventure Log"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"display_name",children:"Display Name"}),(0,a.jsx)(u.p,{id:"display_name",...Y("display_name"),className:U.display_name?"border-red-500":"",placeholder:"Your full name"}),U.display_name&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:U.display_name.message})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"bio",children:"Bio"}),(0,a.jsx)(p.T,{id:"bio",...Y("bio"),className:U.bio?"border-red-500":"",placeholder:"Tell others about yourself and your adventures...",rows:3}),U.bio&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:U.bio.message}),(0,a.jsx)("p",{className:"text-sm text-gray-800",children:"Maximum 500 characters"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"location",children:"Location"}),(0,a.jsx)(u.p,{id:"location",...Y("location"),className:U.location?"border-red-500":"",placeholder:"City, Country"}),U.location&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:U.location.message})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"website",children:"Website"}),(0,a.jsx)(u.p,{id:"website",type:"url",...Y("website"),className:U.website?"border-red-500":"",placeholder:"https://your-website.com"}),U.website&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:U.website.message})]})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)(b(),{href:"/profile",children:(0,a.jsx)(d.$,{type:"button",variant:"outline",children:"Cancel"})}),(0,a.jsx)(d.$,{type:"submit",disabled:S,children:S?"Saving...":(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.A,{className:"h-4 w-4 mr-2"}),"Save Changes"]})})]})]})]}):(0,a.jsx)("div",{className:"space-y-8",children:(0,a.jsx)(f.Zp,{className:"border-yellow-200 bg-yellow-50",children:(0,a.jsx)(f.Wu,{className:"pt-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-yellow-600 font-medium",children:"Profile not found"}),(0,a.jsx)("p",{className:"text-yellow-500 text-sm mt-1",children:"Please complete your profile setup"}),(0,a.jsx)(b(),{href:"/setup",className:"mt-4 inline-block",children:(0,a.jsx)(d.$,{children:"Complete Profile Setup"})})]})})})})}},14806:(e,s,r)=>{"use strict";e.exports=r(30125)},20508:(e,s,r)=>{"use strict";r.d(s,{A:()=>a});let a=(0,r(71847).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},21786:(e,s,r)=>{"use strict";r.d(s,{A:()=>a});let a=(0,r(71847).A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},30125:(e,s,r)=>{"use strict";var a=r(12115),t="function"==typeof Object.is?Object.is:function(e,s){return e===s&&(0!==e||1/e==1/s)||e!=e&&s!=s},l=a.useState,n=a.useEffect,i=a.useLayoutEffect,o=a.useDebugValue;function c(e){var s=e.getSnapshot;e=e.value;try{var r=s();return!t(e,r)}catch(e){return!0}}var d="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,s){return s()}:function(e,s){var r=s(),a=l({inst:{value:r,getSnapshot:s}}),t=a[0].inst,d=a[1];return i(function(){t.value=r,t.getSnapshot=s,c(t)&&d({inst:t})},[e,r,s]),n(function(){return c(t)&&d({inst:t}),e(function(){c(t)&&d({inst:t})})},[e]),o(r),r};s.useSyncExternalStore=void 0!==a.useSyncExternalStore?a.useSyncExternalStore:d},46591:(e,s,r)=>{"use strict";r.d(s,{H4:()=>P,_V:()=>w,bL:()=>g});var a=r(12115),t=r(3468),l=r(70222),n=r(4129),i=r(97602),o=r(14806);function c(){return()=>{}}var d=r(95155),u="Avatar",[m,p]=(0,t.A)(u),[f,h]=m(u),x=a.forwardRef((e,s)=>{let{__scopeAvatar:r,...t}=e,[l,n]=a.useState("idle");return(0,d.jsx)(f,{scope:r,imageLoadingStatus:l,onImageLoadingStatusChange:n,children:(0,d.jsx)(i.sG.span,{...t,ref:s})})});x.displayName=u;var v="AvatarImage",j=a.forwardRef((e,s)=>{let{__scopeAvatar:r,src:t,onLoadingStatusChange:u=()=>{},...m}=e,p=h(v,r),f=function(e,s){let{referrerPolicy:r,crossOrigin:t}=s,l=(0,o.useSyncExternalStore)(c,()=>!0,()=>!1),i=a.useRef(null),d=l?(i.current||(i.current=new window.Image),i.current):null,[u,m]=a.useState(()=>b(d,e));return(0,n.N)(()=>{m(b(d,e))},[d,e]),(0,n.N)(()=>{let e=e=>()=>{m(e)};if(!d)return;let s=e("loaded"),a=e("error");return d.addEventListener("load",s),d.addEventListener("error",a),r&&(d.referrerPolicy=r),"string"==typeof t&&(d.crossOrigin=t),()=>{d.removeEventListener("load",s),d.removeEventListener("error",a)}},[d,t,r]),u}(t,m),x=(0,l.c)(e=>{u(e),p.onImageLoadingStatusChange(e)});return(0,n.N)(()=>{"idle"!==f&&x(f)},[f,x]),"loaded"===f?(0,d.jsx)(i.sG.img,{...m,ref:s,src:t}):null});j.displayName=v;var y="AvatarFallback",N=a.forwardRef((e,s)=>{let{__scopeAvatar:r,delayMs:t,...l}=e,n=h(y,r),[o,c]=a.useState(void 0===t);return a.useEffect(()=>{if(void 0!==t){let e=window.setTimeout(()=>c(!0),t);return()=>window.clearTimeout(e)}},[t]),o&&"loaded"!==n.imageLoadingStatus?(0,d.jsx)(i.sG.span,{...l,ref:s}):null});function b(e,s){return e?s?(e.src!==s&&(e.src=s),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}N.displayName=y;var g=x,w=j,P=N},70222:(e,s,r)=>{"use strict";r.d(s,{c:()=>t});var a=r(12115);function t(e){let s=a.useRef(e);return a.useEffect(()=>{s.current=e}),a.useMemo(()=>(...e)=>s.current?.(...e),[])}},72911:(e,s,r)=>{"use strict";r.d(s,{Fk:()=>n,O5:()=>l,X5:()=>t});var a=r(41508);let t=a.Ikc({email:a.YjP().email("Please enter a valid email address"),password:a.YjP().min(6,"Password must be at least 6 characters")}),l=a.Ikc({email:a.YjP().min(1,"Email is required").email("Please enter a valid email address").transform(e=>e.toLowerCase().trim()).refine(e=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e),"Please enter a valid email address").refine(e=>{if(e.includes("..")||e.includes(" ")||e.includes("	")||e.includes("\n"))return!1;let s=e.split("@")[1];return!(!s||s.endsWith(".")||s.startsWith("."))},"Email format is invalid"),password:a.YjP().min(6,"Password must be at least 6 characters"),confirmPassword:a.YjP()}).refine(e=>e.password===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),n=a.Ikc({username:a.YjP().min(3,"Username must be at least 3 characters").max(50,"Username must be less than 50 characters").regex(/^[a-zA-Z0-9_]+$/,"Username can only contain letters, numbers, and underscores"),display_name:a.YjP().max(100,"Display name must be less than 100 characters").optional(),bio:a.YjP().max(500,"Bio must be less than 500 characters").optional(),website:a.YjP().optional().refine(e=>!e||""===e||a.YjP().url().safeParse(e).success,"Please enter a valid URL"),location:a.YjP().max(100,"Location must be less than 100 characters").optional()})},85897:(e,s,r)=>{"use strict";r.d(s,{BK:()=>i,eu:()=>n,q5:()=>o});var a=r(95155);r(12115);var t=r(46591),l=r(64269);function n(e){let{className:s,...r}=e;return(0,a.jsx)(t.bL,{"data-slot":"avatar",className:(0,l.cn)("relative flex size-8 shrink-0 overflow-hidden rounded-full",s),...r})}function i(e){let{className:s,...r}=e;return(0,a.jsx)(t._V,{"data-slot":"avatar-image",className:(0,l.cn)("aspect-square size-full",s),...r})}function o(e){let{className:s,...r}=e;return(0,a.jsx)(t.H4,{"data-slot":"avatar-fallback",className:(0,l.cn)("bg-muted flex size-full items-center justify-center rounded-full",s),...r})}},97602:(e,s,r)=>{"use strict";r.d(s,{hO:()=>o,sG:()=>i});var a=r(12115),t=r(47650),l=r(32467),n=r(95155),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,s)=>{let r=(0,l.TL)(`Primitive.${s}`),t=a.forwardRef((e,a)=>{let{asChild:t,...l}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,n.jsx)(t?r:s,{...l,ref:a})});return t.displayName=`Primitive.${s}`,{...e,[s]:t}},{});function o(e,s){e&&t.flushSync(()=>e.dispatchEvent(s))}}},e=>{e.O(0,[4545,7559,2619,2784,3147,6677,8441,1255,7358],()=>e(e.s=4839)),_N_E=e.O()}]);